<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Machine Learning-Driven Predictive Modeling for Opioid Use Disorder in Chronic Pain Patients on Long-Term Opioid Use</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="final_project_Lee_files/libs/clipboard/clipboard.min.js"></script>
<script src="final_project_Lee_files/libs/quarto-html/quarto.js"></script>
<script src="final_project_Lee_files/libs/quarto-html/popper.min.js"></script>
<script src="final_project_Lee_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="final_project_Lee_files/libs/quarto-html/anchor.min.js"></script>
<link href="final_project_Lee_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="final_project_Lee_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="final_project_Lee_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="final_project_Lee_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="final_project_Lee_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="final_project_Lee_files/libs/table1-1.0/table1_defaults.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Machine Learning-Driven Predictive Modeling for Opioid Use Disorder in Chronic Pain Patients on Long-Term Opioid Use</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-overview" class="level2">
<h2 class="anchored" data-anchor-id="sec-overview">Overview</h2>
<p>This predictive model aims to identify opioid use disorder among chronic pain patients on long-term opioid therapy by incorporating diverse risk factors, grounded in the biopsychosocial model of pain. It provides a robust predictive framework and serves as a foundation for more advanced machine learning models that will incorporate a broader range of psychiatric conditions, ultimately enhancing early identification and intervention strategies for at-risk patients. For this project, I am collaborating with two psychology experts specializing in substance use disorders, including opioid use disorder.</p>
<ul>
<li>Link to final project GitHub repository) : https://github.com/yoonjae-hub/BMIN503_Final_Project.git</li>
</ul>
</section>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">1. Introduction</h2>
<p>Nearly 51.6 millions of Americans living with chronic pain (Rikard, Strahan et al.&nbsp;2023). Managing chronic non-cancer pain (CNCP) is particularly challenging secondary to its complex neurobiological and psychosocial mechanisms (Fillingim, Bruehl et al.&nbsp;2014), profoundly impacting patients’ physical, psychological, and social well-being (Genova, Dix et al.&nbsp;2020). CNCP is defined as persistent or recurrent pain lasting three months or longer, and encompasses a range of non-malignant conditions, including neuropathic pain, rheumatoid arthritis, lower back pain, osteoarthritis, fibromyalgia, and various other conditions. A major concern with CNCP is the ongoing use of opioids. Opioids are widely prescribed for chronic pain, but can cause adverse outcomes, such as unintentional overdose, misuse, addiction, and even death (Dahlhamer, Connor et al.&nbsp;2021, Dowell, Ragan et al.&nbsp;2022). As many as 25% of patients treated with opioids for chronic pain are known to develop opioid use disorder (OUD) (Cordier Scott and Lewis 2016).</p>
<p>Leveraging AI in healthcare can transform OUD management by analyzing large datasets to develop machine learning (ML) algorithms that identify individuals at risk. This approach enables earlier intervention and more personalized care. Recently, the FDA approved AvertD, an ML-based risk score model designed to assess genetic predisposition to OUD using a prescription-only genotyping test (U.S. Food and Drug Administration 2024). However, AvertD relies solely on buccal swab specimens, excluding significant socioeconomic, physical, and psychological factors associated with OUD. Additionally, AvertD is designed for first-time opioid users, while OUD incidence is higher among individuals on long-term opioid therapy. This highlights the need for an ML model that targets chronic opioid users and integrates broader risk factors for better accessibility and applicability. Therefore, this study aims to develop an ML model to predict OUD among chronic pain patients who have been on opioid therapy, integrating biopsychosocial factors that are known to influence OUD risk.</p>
<p>This problem is inherently interdisciplinary because pain, particularly in the context of chronic pain and opioid use disorder (OUD), cannot be fully understood or addressed from a single disciplinary perspective. The biopsychosocial model emphasizes that pain is influenced not only by biological factors but also by psychological and social dimensions. Therefore, incorporating experts from psychology is essential to explore the psychological underpinnings of pain, such as emotional distress, coping mechanisms, and the role of comorbid psychiatric conditions like anxiety, depression, or substance use disorders.</p>
</section>
<section id="sec-methods" class="level2">
<h2 class="anchored" data-anchor-id="sec-methods">2. Methods</h2>
<p><strong>Data source</strong> This project used dataset that were collected for a larger parent study that evaluated the phenotypic and genotypic profiles of CNCP patients on opioid therapy who did and did not develop an OUD. Data were collected between November 2012 and September 2018. This study includes 1,356 patients who were receiving long-term (6 months or more) opioid therapy (LTOT) to manage CNCP. Subjects were collected from three different regions (Pennsylvania, Washington, and Utah) in the United States. The eligibility criteria for the parent study were: individuals who were (1) aged 18 or older, (2) Caucasian and of European descent (defined as 3 or 4 grandparents were European), (3) experiencing CNCP of musculoskeletal or neuropathic origin persisting for at least 6 months, (4) having no history of substance abuse (except nicotine) before starting LTOT, and (5) having received LTOT to treat their pain for at least the past 6 months. Due to the genotypic and phenotypic objectives of the parent study, persons who are non-Caucasian or with a previous history of substance use disorder were excluded from the study. Additional criteria for exclusion included severe psychiatric conditions that hindered the ability to provide informed consent or complete the questionnaire; and individuals experiencing pain conditions not arising from musculoskeletal/neuropathic origin (e.g., cancer, gynecologic issues, abdominal discomfort, visceral concerns, dental problems, neuropathic pain due to metabolic disease).</p>
<p><strong>Determination of OUD</strong> For this analysis, participants were grouped as either ‘cases’ or ‘controls’ based on whether or not they developed OUD after initiating LTOT. The control group included patients who did not have evidence of opioid abuse or meet the criteria for OUD at the time of assessment. Their electronic health records (EHR) were reviewed monthly for 12 consecutive months after enrolling in the study to ensure they did not develop an OUD after completing the baseline assessment. To be considered controls, patients receiving LTOT needed to have negative urine drug screens (which detect opioid metabolites and other illicit drugs), have no record of current or past SUD, and have evidence of no aberrant drug-related behaviors assessed using an expert developed checklist (Cheatle, O’Brien et al.&nbsp;2013). Cases were patients who did not have a history of SUD (except nicotine) prior to beginning LTOT and currently met DSM-IV criteria for ‘opioid dependence’, which were obtained at the time of enrolling in the study.</p>
<p><strong>Feature Selection</strong> Given the biopsychosocial aspects of OUD, the initial analysis will explore variables such as demographic factors (age, sex, race, ethnicity, marital status, education, employment, financial situation), pain (severity, interference), nicotine dependence, psychiatric conditions (depression, anxiety, pain catastrophizing, mental defeat, suicidality), and social support. To check multicollinearity among these variables, variance inflation factor (VIF) will be used; Variables with a VIF greater than 5 will be deemed highly collinear. In this case, one of the collinear variables will be removed.</p>
<p><strong>Implementation of ML</strong> This study will use a supervised learning approach to develop the predictive model. Given the binary outcome, algorithms such as logistic regression, random forest, and gradient boosting will be employed. To compare performance, each algorithm will be tested using area under the receiver operating characteristic curve (ROC-AOC). A potential challenge in this approach is missing data, as some variables rely on total scores. Missing data in these variables can lead to more extensive data gaps since individual items are not considered separately. To address this, missing data imputation techniques will be considered. Also, to ensure model generalization and detect potential overfitting/underfitting, cross-validation methods (k-fold cross-validation) will be applied.</p>
</section>
<section id="loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="loading-packages">2.1 Loading Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># For graphs</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># For manipulating dates</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary) <span class="co">#Summary statistics</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># For coloring the plots</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot) <span class="co"># For combining multiple plots into one</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'cowplot'

The following object is masked from 'package:lubridate':

    stamp</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr) <span class="co"># Combining multiple graphs into one figure </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'ggpubr'

The following object is masked from 'package:cowplot':

    get_legend</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC) <span class="co"># For cross-validation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.

Attaching package: 'pROC'

The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># For data cleaning</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gtsummary)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData

Attaching package: 'car'

The following object is masked from 'package:dplyr':

    recode

The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ────────────────────────────────────── tidymodels 1.2.0 ──
✔ broom        1.0.7     ✔ recipes      1.1.0
✔ dials        1.3.0     ✔ tune         1.2.1
✔ infer        1.0.7     ✔ workflows    1.1.4
✔ modeldata    1.4.0     ✔ workflowsets 1.1.0
✔ parsnip      1.2.1     ✔ yardstick    1.3.1
── Conflicts ───────────────────────────────────────── tidymodels_conflicts() ──
✖ scales::discard() masks purrr::discard()
✖ dplyr::filter()   masks stats::filter()
✖ recipes::fixed()  masks stringr::fixed()
✖ dplyr::lag()      masks stats::lag()
✖ car::recode()     masks dplyr::recode()
✖ car::some()       masks purrr::some()
✖ yardstick::spec() masks readr::spec()
✖ recipes::step()   masks stats::step()
• Dig deeper into tidy modeling with R at https://www.tmwr.org</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dotwhisker)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parsnip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variables" class="level2">
<h2 class="anchored" data-anchor-id="variables">2.2 Variables</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Predictors</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Demographic - gender (DEM002), age (DEM003), marital status (DEM004), living along (DEM005), education (DEM006), employment (DEM007), financial status (DEM008)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Plesae note that due to the genotypic and phenotypic objectives of the parent study, persones who are non-Caucasian or with a previous history of substance use disorder were excluded from the study)</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>demp_v2 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/demp_v2.sav"</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Pain - severity, interference - Brief Pain Inventory</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>bpip <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/bpip.sav"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#Smoking- Fagerstrom scale</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>fnts<span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/fnts.sav"</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">#Anxiety/Depression-PHQ-4</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>phq4 <span class="ot">&lt;-</span><span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/phq4.sav"</span>)</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Pain catastrophizing (Subscale) - Coping strategies questionnaire</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>copsq<span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/copsq.sav"</span>)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">#Mental defeat-Pain perception scale</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>pps <span class="ot">&lt;-</span><span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/pps.sav"</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">#Suicidality - SBQ-R</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>sbqr <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/sbqr.sav"</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Social support - Duke social support index</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>dssi_v2 <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/dssi_v2.sav"</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">#Outcome - Opioid Use Disorder</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>pevc <span class="ot">&lt;-</span> <span class="fu">read_sav</span>(<span class="st">"/Users/yoonjaelee/Desktop/a_Upenn_PhD_2023-2026/2nd year_Fall 2024/EHR class/Final Project/R01 Data/pevc.sav"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-and-transforming-data-for-analysis" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-and-transforming-data-for-analysis">2.3 Cleaning and Transforming Data for Analysis</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Demographic - gender, age, marital status, living status, education, employment, financial status</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>demo <span class="ot">&lt;-</span>demp_v2 <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DEM002, DEM003, DEM004, DEM005, DEM006, DEM007, DEM008, SubjID)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>demo <span class="ot">&lt;-</span> demo <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(<span class="sc">~</span><span class="fu">inherits</span>(., <span class="st">"haven_labelled"</span>)), </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    as_factor</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>demo <span class="ot">&lt;-</span> demo <span class="sc">%&gt;%</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">where</span>(<span class="sc">~</span><span class="fu">inherits</span>(., <span class="st">"haven_labelled"</span>) <span class="sc">&amp;</span> <span class="fu">is.numeric</span>(.)),</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    as.numeric</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM003[<span class="fu">which</span>(demo<span class="sc">$</span>DEM003 <span class="sc">==</span> <span class="st">"(X)Subject refused to answer"</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM005[<span class="fu">which</span>(demo<span class="sc">$</span>DEM005 <span class="sc">==</span> <span class="st">"Do not know/refused"</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM005 <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(demo<span class="sc">$</span>DEM005)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(demo<span class="sc">$</span>DEM005)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Live alone"                 "One other person"          
[3] "More than one other person"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM006[<span class="fu">which</span>(demo<span class="sc">$</span>DEM006 <span class="sc">==</span> <span class="st">"(X)Subject refused to answer"</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM006 <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(demo<span class="sc">$</span>DEM006)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(demo<span class="sc">$</span>DEM006)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Grade 6 or less"                                
[2] "Grade 7 to 12"                                  
[3] "Graduated high school or high school equivalent"
[4] "Part college"                                   
[5] "Graduated 2 years college"                      
[6] "Graduated 4 years college"                      
[7] "Part graduate/professional school"              
[8] "Completed graduate/professional school"         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM007 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(demo<span class="sc">$</span>DEM007)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM007[<span class="fu">which</span>(demo<span class="sc">$</span>DEM007 <span class="sc">==</span> <span class="st">"Do not know/refused"</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM007 <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(demo<span class="sc">$</span>DEM007)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM007 <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(demo<span class="sc">$</span>DEM007)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(demo<span class="sc">$</span>DEM007)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Yes" "No" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM008 <span class="ot">&lt;-</span> <span class="fu">as.character</span>(demo<span class="sc">$</span>DEM008)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM008[<span class="fu">which</span>(demo<span class="sc">$</span>DEM008 <span class="sc">==</span> <span class="st">"Do not know/Refused"</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM008 <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(demo<span class="sc">$</span>DEM008)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM008 <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(demo<span class="sc">$</span>DEM008)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(demo<span class="sc">$</span>DEM008)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Ca not make ends meet"         "Have just enough to get along"
[3] "Are comfortable"              </code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#transforming to factor (all, except DEM003 - age)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM002 <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(demo<span class="sc">$</span>DEM002)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM003 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(demo<span class="sc">$</span>DEM003)</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM004 <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(demo<span class="sc">$</span>DEM004)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM005 <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(demo<span class="sc">$</span>DEM005)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM006 <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(demo<span class="sc">$</span>DEM006)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM007 <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(demo<span class="sc">$</span>DEM007)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>demo<span class="sc">$</span>DEM008 <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(demo<span class="sc">$</span>DEM008)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#checking (examples)</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(demo<span class="sc">$</span>DEM004)       <span class="co"># Should show "factor"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(demo<span class="sc">$</span>DEM005)      <span class="co"># no 'do not know'refused'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Live alone"                 "One other person"          
[3] "More than one other person"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.numeric</span>(demo<span class="sc">$</span>DEM005)  <span class="co"># Should return FALSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#pain</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#pain-severity</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>pain_severity <span class="ot">&lt;-</span> bpip <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pain_severity_sum =</span> <span class="fu">if_else</span>(<span class="fu">if_any</span>(<span class="fu">c</span>(BPI001, BPI002, BPI003, BPI004), <span class="sc">~</span> . <span class="sc">==</span> <span class="sc">-</span><span class="dv">9</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="cn">NA_real_</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>                                     BPI001 <span class="sc">+</span> BPI002 <span class="sc">+</span> BPI003 <span class="sc">+</span> BPI004)) <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pain_severity_sum, SubjID)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#pain-interference</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>pain_interf <span class="ot">&lt;-</span> bpip <span class="sc">%&gt;%</span></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pain_interf_sum =</span> <span class="fu">if_else</span>(<span class="fu">if_any</span>(<span class="fu">c</span>(BPI007A, BPI007B, BPI007C, BPI007D, BPI007E, BPI007G), <span class="sc">~</span> . <span class="sc">==</span> <span class="sc">-</span><span class="dv">9</span>),</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">NA_real_</span>, <span class="co"># changing -9 to NA value</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>                                   BPI007A <span class="sc">+</span> BPI007B <span class="sc">+</span> BPI007C <span class="sc">+</span> BPI007D <span class="sc">+</span> BPI007E <span class="sc">+</span> BPI007G)) <span class="sc">%&gt;%</span></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pain_interf_sum, SubjID)</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co">#smoking : conditional survey (if FNTS000 entry question is 0, rest of questions are a system missing value; No missing value in FNTS000)</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>missing_fnts <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(fnts<span class="sc">$</span>FNTS000))</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>missing_fnts <span class="co">#for the initial screening question, there is no missing data.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 001, 004: Multiple-choice items (0-3) / # 2,3,5,6: Yes/No items (0-1)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>fnts_cleaned <span class="ot">&lt;-</span> fnts <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">fnts_sum =</span> <span class="fu">ifelse</span>(FNTS000 <span class="sc">==</span> <span class="dv">0</span>, <span class="cn">NA</span>,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>                         FNTS001 <span class="sc">+</span> FNTS004 <span class="sc">+</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>                         FNTS002 <span class="sc">+</span> FNTS003 <span class="sc">+</span> FNTS005 <span class="sc">+</span> FNTS006)) <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(<span class="at">fnts_sum=</span><span class="dv">0</span>))</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>fnts_cleaned <span class="ot">&lt;-</span> fnts_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month<span class="sc">==</span><span class="dv">0</span>)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>fnts_cleaned <span class="ot">&lt;-</span> fnts_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dependence_level =</span> <span class="fu">case_when</span>(</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    fnts_sum <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"Non-smoker"</span>,</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    fnts_sum <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> fnts_sum <span class="sc">&lt;=</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Low"</span>,</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    fnts_sum <span class="sc">&gt;=</span> <span class="dv">3</span> <span class="sc">&amp;</span> fnts_sum <span class="sc">&lt;=</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Low to Moderate"</span>,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    fnts_sum <span class="sc">&gt;=</span> <span class="dv">5</span> <span class="sc">&amp;</span> fnts_sum <span class="sc">&lt;=</span> <span class="dv">7</span> <span class="sc">~</span> <span class="st">"Moderate"</span>,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    fnts_sum <span class="sc">&gt;=</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"High"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, fnts_sum, dependence_level)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>fnts_cleaned_2 <span class="ot">&lt;-</span> fnts_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, dependence_level) <span class="co">#sort out only two variables</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a><span class="co">#PHQ-4 (Anxiety/Depression)</span></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>phq4 <span class="ot">&lt;-</span> phq4 <span class="sc">%&gt;%</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span> (month <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a><span class="co">#PHQ-4: dichotomizing Anxiety, cutoff &gt;=3</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a><span class="co">#PHQ-4: dichotomizing Depression, cutoff &gt;=3</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>phq4 <span class="ot">&lt;-</span> phq4 <span class="sc">%&gt;%</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Anxiety =</span> <span class="fu">ifelse</span>(PHQ001 <span class="sc">+</span> PHQ002 <span class="sc">&gt;=</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">Depression =</span> <span class="fu">ifelse</span>(PHQ003 <span class="sc">+</span> PHQ004 <span class="sc">&gt;=</span> <span class="dv">3</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>phq4_cleaned <span class="ot">&lt;-</span> phq4 <span class="sc">%&gt;%</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Anxiety, Depression, SubjID)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>phq4_cleaned<span class="sc">$</span>Anxiety <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(phq4_cleaned<span class="sc">$</span>Anxiety)</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>phq4_cleaned<span class="sc">$</span>Depression <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(phq4_cleaned<span class="sc">$</span>Depression)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a><span class="co">#CSQ - Pain catastrophizing subscale only (score already calculated in the orignal dataset: CATAT)</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>ca_catastro <span class="ot">&lt;-</span> copsq <span class="sc">%&gt;%</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ca_sum =</span> <span class="fu">if_else</span>(<span class="fu">if_any</span>(<span class="fu">c</span>(COP005, COP012, COP014, COP028, COP038, COP042), <span class="sc">~</span> . <span class="sc">==</span> <span class="sc">-</span><span class="dv">9</span>),</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>                                   <span class="cn">NA_real_</span>,</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>                                   COP005 <span class="sc">+</span> COP012 <span class="sc">+</span> COP014 <span class="sc">+</span> COP028 <span class="sc">+</span> COP038 <span class="sc">+</span> COP042)) <span class="sc">%&gt;%</span></span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(ca_sum,SubjID)</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a><span class="do">##PSPS -HAVE some missing vales (pps_sum)</span></span>
<span id="cb31-47"><a href="#cb31-47" aria-hidden="true" tabindex="-1"></a>pps_cleaned <span class="ot">&lt;-</span>pps <span class="sc">%&gt;%</span></span>
<span id="cb31-48"><a href="#cb31-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pps_sum=</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"PPS"</span>), <span class="sc">~</span> <span class="fu">ifelse</span>(. <span class="sc">==</span> <span class="sc">-</span><span class="dv">9</span>, <span class="cn">NA</span>, .), <span class="at">.names =</span> <span class="st">"new_{.col}"</span>)), <span class="at">na.rm=</span> <span class="cn">FALSE</span>)</span>
<span id="cb31-49"><a href="#cb31-49" aria-hidden="true" tabindex="-1"></a>pps_cleaned <span class="ot">&lt;-</span> pps_cleaned<span class="sc">%&gt;%</span></span>
<span id="cb31-50"><a href="#cb31-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(pps_sum, SubjID)</span>
<span id="cb31-51"><a href="#cb31-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-52"><a href="#cb31-52" aria-hidden="true" tabindex="-1"></a>missing_pps <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(pps_cleaned<span class="sc">$</span>pps_sum))</span>
<span id="cb31-53"><a href="#cb31-53" aria-hidden="true" tabindex="-1"></a>missing_pps <span class="co">#n=85</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 85</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Suicidality: cutoff &gt;=8 (higher risk) for clinical samples / no missing values, but '-9' refused to answer-&gt; Total score is NA whenever a -9 value is present in any of the specified columns. (NA in total score = only 6 data)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co">#scoring website: https://www.ncbi.nlm.nih.gov/books/NBK571017/box/ch3.b11/?report=objectonly</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>sbqr_cleaned <span class="ot">&lt;-</span> sbqr <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">SBQ001 =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>      SBQ001 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>) <span class="sc">~</span> <span class="dv">3</span>, <span class="co">#regrouping</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>      SBQ001 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">6</span>) <span class="sc">~</span> <span class="dv">4</span>,</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> SBQ001),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">SBQ003 =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>      SBQ003 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>) <span class="sc">~</span> <span class="dv">2</span>,</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>      SBQ003 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">~</span> <span class="dv">3</span>,</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> SBQ003))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>sbqr_cleaned <span class="ot">&lt;-</span> sbqr_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>     <span class="fu">mutate</span>(<span class="at">sbqr_sum =</span> <span class="fu">if_else</span>(</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">select</span>(., SBQ001, SBQ002, SBQ003, SBQ004) <span class="sc">==</span> <span class="sc">-</span><span class="dv">9</span>) <span class="sc">&gt;</span> <span class="dv">0</span>,</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>      <span class="cn">NA_real_</span>,</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rowSums</span>(<span class="fu">select</span>(., SBQ001, SBQ002, SBQ003, SBQ004), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, sbqr_sum)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">#Categorize suicidality risk based on sbqr_sum (&gt;=8; high risk, &lt;8: low risk, NA=&gt; NA)(&gt;=8; high risk, &lt;8: low risk, NA=&gt; NA); missing data = 6ea</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>sbqr_cleaned <span class="ot">&lt;-</span> sbqr_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">suicidality_risk =</span> <span class="fu">case_when</span>(</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>      sbqr_sum <span class="sc">&gt;=</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"High Risk"</span>,</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>      sbqr_sum <span class="sc">&lt;</span> <span class="dv">8</span> <span class="sc">~</span> <span class="st">"Low Risk"</span>,</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(sbqr_sum) <span class="sc">~</span> <span class="cn">NA_character_</span>))</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>suicidality <span class="ot">&lt;-</span> sbqr_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, suicidality_risk)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a><span class="co">#social support (DSSI) : 3 subscales scores</span></span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>dssi_cleaned <span class="ot">&lt;-</span> dssi_v2 <span class="sc">%&gt;%</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(month<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, SIDSSI, SSDSSI, ISDSSI)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a><span class="co">#social interaction (SIS, 4 item) : assessing the amount of time: 3 point likert scale (missing data: NONE)</span></span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a><span class="do">## dssi_cleaned$SIDSSI</span></span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a><span class="co">#subjective social support (SSS, 7 items): assessing depth or quality of relationship: 3point (missing data: 14)</span></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a><span class="do">## dssi_cleaned$SSDSSI</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a><span class="co">#Instrumental social support (ISS, 12 items): degree to which others can be counted upon with daily activities;0/1; (missing data: 4)</span></span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a><span class="do">## dssi_cleaned$ISDSSI</span></span>
<span id="cb33-46"><a href="#cb33-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-47"><a href="#cb33-47" aria-hidden="true" tabindex="-1"></a><span class="co">#outcome: opioid use disorder (cohort - 1: case=OUD, 0: control=no OUD)</span></span>
<span id="cb33-48"><a href="#cb33-48" aria-hidden="true" tabindex="-1"></a>cohort <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"/Users/yoonjaelee/Desktop/Dr.CHEATLE ML PROJECT/pevc_compiled.csv"</span>)</span>
<span id="cb33-49"><a href="#cb33-49" aria-hidden="true" tabindex="-1"></a>cohort_cleaned <span class="ot">&lt;-</span> cohort <span class="sc">%&gt;%</span></span>
<span id="cb33-50"><a href="#cb33-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID,cohort)</span>
<span id="cb33-51"><a href="#cb33-51" aria-hidden="true" tabindex="-1"></a>cohort_cleaned<span class="sc">$</span>cohort <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(cohort_cleaned<span class="sc">$</span>cohort) <span class="co">#changing the class to categorical values.</span></span>
<span id="cb33-52"><a href="#cb33-52" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(cohort_cleaned<span class="sc">$</span>cohort) <span class="co">#factor</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "factor"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#removing 16 Nas</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>cohort_cleaned <span class="ot">&lt;-</span> cohort_cleaned[<span class="sc">!</span><span class="fu">is.na</span>(cohort_cleaned<span class="sc">$</span>cohort), ]</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>cohort_cleaned <span class="ot">&lt;-</span> cohort_cleaned <span class="sc">%&gt;%</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SubjID <span class="sc">!=</span> <span class="dv">0</span>) <span class="co">#remove SubjID==0</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cohort_cleaned<span class="sc">$</span>cohort)  <span class="co">#cohort 0:1042; 1:486</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
1042  486 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Merging data_using left_join</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>merging1 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cohort_cleaned, demo, <span class="at">by =</span> <span class="st">"SubjID"</span>)</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Note that when merging demo file with cohort_cleaned file, there are missing data -&gt; remove; not registered for the study. (removed 173 patients)</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>merging1 <span class="ot">&lt;-</span> merging1 <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>merging2 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merging1, pain_severity, <span class="at">by =</span> <span class="st">"SubjID"</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>merging3 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merging2, pain_interf, <span class="at">by =</span> <span class="st">"SubjID"</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>merging4 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merging3, fnts_cleaned_2, <span class="at">by =</span> <span class="st">"SubjID"</span>)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>merging5 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merging4, phq4_cleaned, <span class="at">by =</span> <span class="st">"SubjID"</span>)</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>merging6 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merging5, ca_catastro, <span class="at">by =</span> <span class="st">"SubjID"</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>merging7 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merging6, pps_cleaned, <span class="at">by =</span> <span class="st">"SubjID"</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>merging8 <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merging7, suicidality, <span class="at">by =</span> <span class="st">"SubjID"</span>)</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(merging8, dssi_cleaned, <span class="at">by =</span> <span class="st">"SubjID"</span>) <span class="co">#final sample N= 1331</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(final_data<span class="sc">$</span>cohort) <span class="co">#901/430</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
901 430 </code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis-distributionassociation" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-distributionassociation">2.4 Exploratory Data Analysis (Distribution/Association)</h2>
<p>Based on distribution analysis, most of variables were skewed. However, given the large sample size, we can rely on the Central Limit Theorem to approximate normalilty.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Categorical variables</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#1-1) Fnts - Visualization</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>fnts_eda <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cohort_cleaned, fnts_cleaned, <span class="at">by =</span> <span class="st">"SubjID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(dependence_level), <span class="sc">!</span><span class="fu">is.na</span>(cohort))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(fnts_eda, <span class="fu">aes</span>(<span class="at">x =</span> dependence_level, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Dependence Level"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">fill =</span> <span class="st">"OUD Status"</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>oud_smoking <span class="ot">&lt;-</span> <span class="fu">table</span>(final_data<span class="sc">$</span>cohort, final_data<span class="sc">$</span>dependence_level)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(oud_smoking) <span class="co"># All cells &gt;5. okay to perform chi-square test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
    High Low Low to Moderate Moderate Non-smoker
  0   20  54              47       59        694
  1   43  49              75      123        109</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>chi_oud_smoking <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(oud_smoking)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chi_oud_smoking) <span class="co"># p-value &lt; 2.2e-16 -&gt; Significantly associated.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  oud_smoking
X-squared = 332.86, df = 4, p-value &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2-1) phq4 - Distribution</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>phq4_eda <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cohort_cleaned, phq4_cleaned, <span class="at">by =</span> <span class="st">"SubjID"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Anxiety), <span class="sc">!</span><span class="fu">is.na</span>(Depression))</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phq4_eda, <span class="fu">aes</span>(<span class="at">x =</span> Anxiety, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Anxiety"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">fill =</span> <span class="st">"OUD Status"</span>) <span class="sc">+</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"No"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Yes"</span>)) <span class="sc">+</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(phq4_eda, <span class="fu">aes</span>(<span class="at">x =</span> Depression, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Depression"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">fill =</span> <span class="st">"OUD Status"</span>) <span class="sc">+</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"No"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Yes"</span>)) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2-2) phq4 - Association</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>oud_anxiety <span class="ot">&lt;-</span> <span class="fu">table</span>(final_data<span class="sc">$</span>cohort, final_data<span class="sc">$</span>Anxiety)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(oud_anxiety) <span class="co"># expected counts &gt;5. okay to perform chi-square test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  0 473 396
  1 144 248</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>chi_oud_anxiety <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(oud_anxiety, <span class="at">correct=</span>F)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chi_oud_anxiety) <span class="co"># p-value = 2.391e-09 -&gt; Significantly associated.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  oud_anxiety
X-squared = 33.852, df = 1, p-value = 5.947e-09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>oud_dep <span class="ot">&lt;-</span> <span class="fu">table</span>(final_data<span class="sc">$</span>cohort, final_data<span class="sc">$</span>Depression)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(oud_dep) <span class="co"># expected counts &gt;5. okay to perform chi-square test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
      0   1
  0 517 352
  1 156 236</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>chi_oud_dep <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(oud_dep, <span class="at">correct=</span>F)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chi_oud_dep) <span class="co"># p-value = 3.518e-11 -&gt; Significantly associated.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  oud_dep
X-squared = 42.117, df = 1, p-value = 8.595e-11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3-1) SBQR-R - Distribution</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>sbqr_eda <span class="ot">&lt;-</span> <span class="fu">left_join</span>(cohort_cleaned, sbqr_cleaned, <span class="at">by =</span> <span class="st">"SubjID"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(suicidality_risk))</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sbqr_eda, <span class="fu">aes</span>(<span class="at">x =</span> suicidality_risk, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Suicidality risk"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">fill =</span> <span class="st">"OUD Status"</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"No"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Yes"</span>)) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3-2) SBQR-R - Association</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>oud_sui <span class="ot">&lt;-</span> <span class="fu">table</span>(final_data<span class="sc">$</span>cohort, final_data<span class="sc">$</span>suicidality_risk)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(oud_sui) <span class="co"># expected counts &gt;5. okay to perform chi-square test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
    High Risk Low Risk
  0        58      429
  1        77      161</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>chi_oud_sui <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(oud_sui, <span class="at">correct=</span>F)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chi_oud_sui) <span class="co"># p-value = 3.123e-11 -&gt; Significantly associated.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  oud_sui
X-squared = 44.092, df = 1, p-value = 3.133e-11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Continuous variables </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co">#1-1)Pain severity - Visualization</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>ps_data_noNA <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cohort), <span class="sc">!</span><span class="fu">is.na</span>(pain_severity_sum))</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ps_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(cohort), <span class="at">y =</span> pain_severity_sum, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightyellow"</span>, <span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Cohort"</span>, <span class="at">y =</span> <span class="st">"Pain Severity Sum"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="dv">0</span>, <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ps_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> pain_severity_sum, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> cohort, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Case"</span>))) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram with Density Curve"</span>, <span class="at">x =</span> <span class="st">"Pain Severity Sum"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1-2)Pain severity - Association</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>ps.nonoud <span class="ot">&lt;-</span> ps_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID,pain_severity_sum)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>ps.oud <span class="ot">&lt;-</span> ps_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, pain_severity_sum)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(ps.nonoud<span class="sc">$</span>pain_severity_sum, ps.oud<span class="sc">$</span>pain_severity_sum) <span class="co">#p-value = 0.001172 -&gt; unequal variance -&gt; welch's t-test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  ps.nonoud$pain_severity_sum and ps.oud$pain_severity_sum
F = 0.7723, num df = 875, denom df = 399, p-value = 0.002074
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.6513741 0.9108211
sample estimates:
ratio of variances 
         0.7723014 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>ps_ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(ps.nonoud<span class="sc">$</span>pain_severity_sum, ps.oud<span class="sc">$</span>pain_severity_sum)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ps_ttest) <span class="co">#statistically different.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  ps.nonoud$pain_severity_sum and ps.oud$pain_severity_sum
t = 5.222, df = 690.86, p-value = 2.345e-07
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 1.583093 3.490811
sample estimates:
mean of x mean of y 
 21.72945  19.19250 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2-1)pain interference - Visualization</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>pi_data_noNA <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cohort), <span class="sc">!</span><span class="fu">is.na</span>(pain_interf_sum))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pi_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(cohort), <span class="at">y =</span> pain_interf_sum, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightyellow"</span>, <span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Cohort"</span>, <span class="at">y =</span> <span class="st">"Pain Interference Sum"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="dv">0</span>, <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pi_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> pain_interf_sum, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> cohort, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Case"</span>))) <span class="sc">+</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram with Density Curve"</span>, <span class="at">x =</span> <span class="st">"Pain Interference Sum"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#2-2)pain interference - Association</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>pi.nonoud <span class="ot">&lt;-</span> pi_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID,pain_interf_sum)</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>pi.oud <span class="ot">&lt;-</span> pi_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, pain_interf_sum)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(pi.nonoud<span class="sc">$</span>pain_interf_sum, pi.oud<span class="sc">$</span>pain_interf_sum) <span class="co"># p-value = 0.8104 -&gt; equal variance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  pi.nonoud$pain_interf_sum and pi.oud$pain_interf_sum
F = 0.9773, num df = 826, denom df = 390, p-value = 0.7834
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.8219306 1.1559193
sample estimates:
ratio of variances 
         0.9773002 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>pi_ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(pi.nonoud<span class="sc">$</span>pain_interf_sum, pi.oud<span class="sc">$</span>pain_interf_sum, <span class="at">var.equal =</span> T)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pi_ttest) <span class="co">#statistically different.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  pi.nonoud$pain_interf_sum and pi.oud$pain_interf_sum
t = 2.168, df = 1216, p-value = 0.03035
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 0.194941 3.906501
sample estimates:
mean of x mean of y 
 33.58525  31.53453 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3-1) pain catastrophizing - Distribution</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>pc_data_noNA <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cohort), <span class="sc">!</span><span class="fu">is.na</span>(ca_sum))</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pc_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(cohort), <span class="at">y =</span> ca_sum, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightyellow"</span>, <span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Cohort"</span>, <span class="at">y =</span> <span class="st">"Pain Catastrophizing Sum"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="dv">0</span>, <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pc_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> ca_sum, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> cohort, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Case"</span>))) <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram with Density Curve"</span>, <span class="at">x =</span> <span class="st">"Pain Catastrohpizing"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-10.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#3-2) pain catastrophizing - Association</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>pc.nonoud <span class="ot">&lt;-</span> pc_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID,ca_sum)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>pc.oud <span class="ot">&lt;-</span> pc_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, ca_sum)</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(pc.nonoud<span class="sc">$</span>ca_sum, pc.oud<span class="sc">$</span>ca_sum) <span class="co">#p-value = 0.01178 -&gt; unequal variance -&gt; welch's t-test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  pc.nonoud$ca_sum and pc.oud$ca_sum
F = 1.2806, num df = 836, denom df = 366, p-value = 0.006322
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 1.072940 1.519366
sample estimates:
ratio of variances 
           1.28062 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>pc_ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(pc.nonoud<span class="sc">$</span>ca_sum, pc.oud<span class="sc">$</span>ca_sum)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(pc_ttest) <span class="co">#statistically different.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  pc.nonoud$ca_sum and pc.oud$ca_sum
t = -7.9363, df = 784.18, p-value = 7.194e-15
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -4.699746 -2.835854
sample estimates:
mean of x mean of y 
 14.26762  18.03542 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">#4-1)PSPS - Mental defeat - Distribution</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>psps_data_noNA <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(pps_sum))</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(psps_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(cohort), <span class="at">y =</span> pps_sum, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_violin</span>(<span class="at">fill =</span> <span class="st">"lightyellow"</span>, <span class="at">draw_quantiles =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>)) <span class="sc">+</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Cohort"</span>, <span class="at">y =</span> <span class="st">"Mental defeat"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_jitter</span>(<span class="at">height =</span> <span class="dv">0</span>, <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-11.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(psps_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> ca_sum, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> cohort, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Case"</span>))) <span class="sc">+</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram with Density Curve"</span>, <span class="at">x =</span> <span class="st">"Mental Defeat"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 29 rows containing non-finite outside the scale range
(`stat_bin()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 29 rows containing non-finite outside the scale range
(`stat_density()`).</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-12.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">#4-2) PSPS - Mental defeat - Association</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>md.nonoud <span class="ot">&lt;-</span> psps_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID,pps_sum)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>md.oud <span class="ot">&lt;-</span> psps_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, pps_sum)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(md.nonoud<span class="sc">$</span>pps_sum, md.oud<span class="sc">$</span>pps_sum) <span class="co">#p-value = 0.3597 -&gt; equal variance -&gt; Levene's t-test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  md.nonoud$pps_sum and md.oud$pps_sum
F = 1.1209, num df = 582, denom df = 225, p-value = 0.3163
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.896521 1.386564
sample estimates:
ratio of variances 
          1.120889 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>md_ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(md.nonoud<span class="sc">$</span>pps_sum, md.oud<span class="sc">$</span>pps_sum, <span class="at">var.equal=</span>T)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(md_ttest) <span class="co">#statistically different.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  md.nonoud$pps_sum and md.oud$pps_sum
t = -6.6498, df = 807, p-value = 5.407e-11
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -18.371066  -9.997216
sample estimates:
mean of x mean of y 
 31.39108  45.57522 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">#5-1) DSSI - Distribution (SIDSSI, SSDSSI, ISDSSI (all continuous))</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>dssi_data_noNA <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(SIDSSI), <span class="sc">!</span><span class="fu">is.na</span>(SSDSSI), <span class="sc">!</span><span class="fu">is.na</span>(ISDSSI))</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dssi_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> SIDSSI, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> cohort, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Case"</span>))) <span class="sc">+</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram with Density Curve"</span>, <span class="at">x =</span> <span class="st">"SIDSSI"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-13.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dssi_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> SSDSSI, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> cohort, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Case"</span>))) <span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram with Density Curve"</span>, <span class="at">x =</span> <span class="st">"SSDSSI"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-14.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dssi_data_noNA, <span class="fu">aes</span>(<span class="at">x =</span> ISDSSI, <span class="at">fill =</span> <span class="fu">as.factor</span>(cohort))) <span class="sc">+</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y =</span> ..density..), <span class="at">bins =</span> <span class="dv">20</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> cohort, <span class="at">labeller =</span> <span class="fu">as_labeller</span>(<span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"Control"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"Case"</span>))) <span class="sc">+</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Histogram with Density Curve"</span>, <span class="at">x =</span> <span class="st">"ISDSSI"</span>, <span class="at">fill =</span> <span class="st">"Cohort"</span>) <span class="sc">+</span></span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_discrete</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Case"</span>)) <span class="sc">+</span></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-4-15.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">#5-2) DSSI - Association</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="co">#5-2-1) SIDSSI</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>sidssi.nonoud <span class="ot">&lt;-</span> dssi_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID,SIDSSI)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>sidssi.oud <span class="ot">&lt;-</span> dssi_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, SIDSSI)</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(sidssi.nonoud<span class="sc">$</span>SIDSSI, sidssi.oud<span class="sc">$</span>SIDSSI) <span class="co">#p-value = 0.5777 -&gt; equal variance -&gt; Levene's t-test</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  sidssi.nonoud$SIDSSI and sidssi.oud$SIDSSI
F = 0.94976, num df = 838, denom df = 375, p-value = 0.5488
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.7970469 1.1252390
sample estimates:
ratio of variances 
         0.9497572 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>sidssi_ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(sidssi.nonoud<span class="sc">$</span>SIDSSI, sidssi.oud<span class="sc">$</span>SIDSSI, <span class="at">var.equal=</span>T)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sidssi_ttest) <span class="co">#statistically NOT different.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Two Sample t-test

data:  sidssi.nonoud$SIDSSI and sidssi.oud$SIDSSI
t = 0.2859, df = 1213, p-value = 0.775
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 -0.2432314  0.3262139
sample estimates:
mean of x mean of y 
 5.193087  5.151596 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#5-2-2) SSDSSI</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>ssdssi.nonoud <span class="ot">&lt;-</span> dssi_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID,SSDSSI)</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>ssdssi.oud <span class="ot">&lt;-</span> dssi_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb93-8"><a href="#cb93-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, SSDSSI)</span>
<span id="cb93-9"><a href="#cb93-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-10"><a href="#cb93-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(ssdssi.nonoud<span class="sc">$</span>SSDSSI, ssdssi.oud<span class="sc">$</span>SSDSSI) <span class="co">#p-value = 0.006159 -&gt; unequal variance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  ssdssi.nonoud$SSDSSI and ssdssi.oud$SSDSSI
F = 0.79046, num df = 838, denom df = 375, p-value = 0.006448
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.6633604 0.9365058
sample estimates:
ratio of variances 
         0.7904571 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>ssdssi_ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(ssdssi.nonoud<span class="sc">$</span>SSDSSI, ssdssi.oud<span class="sc">$</span>SSDSSI)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ssdssi_ttest) <span class="co">#statistically different.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  ssdssi.nonoud$SSDSSI and ssdssi.oud$SSDSSI
t = 9.7284, df = 651.18, p-value &lt; 2.2e-16
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 1.724496 2.596701
sample estimates:
mean of x mean of y 
 17.94517  15.78457 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#5-2-3) ISDSSI</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>isdssi.nonoud <span class="ot">&lt;-</span> dssi_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">0</span>)<span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID,ISDSSI)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>isdssi.oud <span class="ot">&lt;-</span> dssi_data_noNA <span class="sc">%&gt;%</span></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cohort<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SubjID, ISDSSI)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a><span class="fu">var.test</span>(isdssi.nonoud<span class="sc">$</span>ISDSSI, isdssi.oud<span class="sc">$</span>ISDSSI) <span class="co">#p-value = 1.458e-06 -&gt; unequal variance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    F test to compare two variances

data:  isdssi.nonoud$ISDSSI and isdssi.oud$ISDSSI
F = 0.67218, num df = 838, denom df = 375, p-value = 3.597e-06
alternative hypothesis: true ratio of variances is not equal to 1
95 percent confidence interval:
 0.5641025 0.7963774
sample estimates:
ratio of variances 
         0.6721818 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>isdssi_ttest <span class="ot">&lt;-</span> <span class="fu">t.test</span>(isdssi.nonoud<span class="sc">$</span>ISDSSI, isdssi.oud<span class="sc">$</span>ISDSSI)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(isdssi_ttest) <span class="co">#statistically different.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Welch Two Sample t-test

data:  isdssi.nonoud$ISDSSI and isdssi.oud$ISDSSI
t = 3.294, df = 610.18, p-value = 0.001045
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
 0.2609288 1.0314215
sample estimates:
mean of x mean of y 
 8.702026  8.055851 </code></pre>
</div>
</div>
</section>
<section id="descriptive-analysis" class="level2">
<h2 class="anchored" data-anchor-id="descriptive-analysis">2.4.1 Descriptive Analysis</h2>
<section id="sample-characteristics" class="level3">
<h3 class="anchored" data-anchor-id="sample-characteristics">Sample characteristics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Hmisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:parsnip':

    translate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    src, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    format.pval, units</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(table1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'table1'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:Hmisc':

    label, label&lt;-, units</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    units, units&lt;-</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocessing: Filter out rows where "Refused to answer" is present</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>final_data_clean <span class="ot">&lt;-</span> final_data[<span class="sc">!</span>(final_data<span class="sc">$</span>DEM002 <span class="sc">==</span> <span class="st">"(X)Subject refused to answer"</span> <span class="sc">|</span> </span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>                                 final_data<span class="sc">$</span>DEM004 <span class="sc">==</span> <span class="st">"(X)Subject refused to answer"</span>), ]</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>final_data_clean <span class="ot">&lt;-</span> <span class="fu">droplevels</span>(final_data_clean)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Relabel the cohort variable</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>final_data_clean<span class="sc">$</span>cohort <span class="ot">&lt;-</span> <span class="fu">factor</span>(final_data_clean<span class="sc">$</span>cohort, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non-OUD"</span>, <span class="st">"OUD"</span>))</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigning labels to variables for better readability</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>DEM002) <span class="ot">&lt;-</span> <span class="st">"Gender"</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>DEM003) <span class="ot">&lt;-</span> <span class="st">"Age (years)"</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>DEM004) <span class="ot">&lt;-</span> <span class="st">"Marital Status"</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>DEM005) <span class="ot">&lt;-</span> <span class="st">"Household"</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>DEM006) <span class="ot">&lt;-</span> <span class="st">"Education"</span></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>DEM007) <span class="ot">&lt;-</span> <span class="st">"Employment"</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>DEM008) <span class="ot">&lt;-</span> <span class="st">"Financial Status"</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Print demographic characteristics</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Demographic characteristics in non-OUD and OUD groups"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Demographic characteristics in non-OUD and OUD groups</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the table</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table1</span>(<span class="sc">~</span> DEM002 <span class="sc">+</span> DEM003 <span class="sc">+</span> DEM004 <span class="sc">+</span> DEM005 <span class="sc">+</span> DEM006 <span class="sc">+</span> DEM007 <span class="sc">+</span> DEM008 <span class="sc">|</span> cohort, </span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">data =</span> final_data_clean, <span class="at">rowlabelhead =</span> <span class="st">"Demographics"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="Rtable1">
<table class="Rtable1 caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th class="rowlabel firstrow lastrow" data-quarto-table-cell-role="th">Demographics</th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Non-OUD<br>
<span class="stratn">(N=901)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">OUD<br>
<span class="stratn">(N=430)</span></span></th>
<th class="firstrow lastrow" data-quarto-table-cell-role="th"><span class="stratlabel">Overall<br>
<span class="stratn">(N=1331)</span></span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td class="rowlabel firstrow">Gender</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Male</td>
<td>299 (33.2%)</td>
<td>231 (53.7%)</td>
<td>530 (39.8%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Female</td>
<td class="lastrow">602 (66.8%)</td>
<td class="lastrow">199 (46.3%)</td>
<td class="lastrow">801 (60.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Age (years)</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Mean (SD)</td>
<td>38.2 (12.7)</td>
<td>24.9 (11.1)</td>
<td>33.9 (13.7)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Median [Min, Max]</td>
<td class="lastrow">39.0 [2.00, 69.0]</td>
<td class="lastrow">22.0 [5.00, 57.0]</td>
<td class="lastrow">35.0 [2.00, 69.0]</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Marital Status</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Married/Partnered</td>
<td>539 (59.8%)</td>
<td>98 (22.8%)</td>
<td>637 (47.9%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">Separated</td>
<td>28 (3.1%)</td>
<td>33 (7.7%)</td>
<td>61 (4.6%)</td>
</tr>
<tr class="even">
<td class="rowlabel">Divorced</td>
<td>154 (17.1%)</td>
<td>77 (17.9%)</td>
<td>231 (17.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">Never married</td>
<td>145 (16.1%)</td>
<td>210 (48.8%)</td>
<td>355 (26.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Widowed</td>
<td class="lastrow">35 (3.9%)</td>
<td class="lastrow">12 (2.8%)</td>
<td class="lastrow">47 (3.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Household</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Live alone</td>
<td>149 (16.5%)</td>
<td>80 (18.6%)</td>
<td>229 (17.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">One other person</td>
<td>407 (45.2%)</td>
<td>116 (27.0%)</td>
<td>523 (39.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">More than one other person</td>
<td class="lastrow">345 (38.3%)</td>
<td class="lastrow">234 (54.4%)</td>
<td class="lastrow">579 (43.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Education</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Grade 6 or less</td>
<td>3 (0.3%)</td>
<td>2 (0.5%)</td>
<td>5 (0.4%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">Grade 7 to 12</td>
<td>49 (5.4%)</td>
<td>77 (17.9%)</td>
<td>126 (9.5%)</td>
</tr>
<tr class="even">
<td class="rowlabel">Graduated high school or high school equivalent</td>
<td>183 (20.3%)</td>
<td>167 (38.8%)</td>
<td>350 (26.3%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">Part college</td>
<td>233 (25.9%)</td>
<td>103 (24.0%)</td>
<td>336 (25.2%)</td>
</tr>
<tr class="even">
<td class="rowlabel">Graduated 2 years college</td>
<td>120 (13.3%)</td>
<td>29 (6.7%)</td>
<td>149 (11.2%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">Graduated 4 years college</td>
<td>145 (16.1%)</td>
<td>28 (6.5%)</td>
<td>173 (13.0%)</td>
</tr>
<tr class="even">
<td class="rowlabel">Part graduate/professional school</td>
<td>44 (4.9%)</td>
<td>7 (1.6%)</td>
<td>51 (3.8%)</td>
</tr>
<tr class="odd">
<td class="rowlabel lastrow">Completed graduate/professional school</td>
<td class="lastrow">124 (13.8%)</td>
<td class="lastrow">17 (4.0%)</td>
<td class="lastrow">141 (10.6%)</td>
</tr>
<tr class="even">
<td class="rowlabel firstrow">Employment</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="odd">
<td class="rowlabel">Yes</td>
<td>230 (25.5%)</td>
<td>120 (27.9%)</td>
<td>350 (26.3%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">No</td>
<td class="lastrow">671 (74.5%)</td>
<td class="lastrow">310 (72.1%)</td>
<td class="lastrow">981 (73.7%)</td>
</tr>
<tr class="odd">
<td class="rowlabel firstrow">Financial Status</td>
<td class="firstrow"></td>
<td class="firstrow"></td>
<td class="firstrow"></td>
</tr>
<tr class="even">
<td class="rowlabel">Ca not make ends meet</td>
<td>176 (19.5%)</td>
<td>216 (50.2%)</td>
<td>392 (29.5%)</td>
</tr>
<tr class="odd">
<td class="rowlabel">Have just enough to get along</td>
<td>416 (46.2%)</td>
<td>179 (41.6%)</td>
<td>595 (44.7%)</td>
</tr>
<tr class="even">
<td class="rowlabel lastrow">Are comfortable</td>
<td class="lastrow">309 (34.3%)</td>
<td class="lastrow">35 (8.1%)</td>
<td class="lastrow">344 (25.8%)</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="predictors---descriptive-analysis-not-working-due-to-missingness" class="level3">
<h3 class="anchored" data-anchor-id="predictors---descriptive-analysis-not-working-due-to-missingness">Predictors - descriptive analysis (not working due to missingness)</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Relabel the cohort variable</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>final_data_clean<span class="sc">$</span>cohort <span class="ot">&lt;-</span> <span class="fu">factor</span>(final_data_clean<span class="sc">$</span>cohort, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Non-OUD"</span>, <span class="st">"OUD"</span>))</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigning labels to variables for better readability</span></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>pain_severity_sum) <span class="ot">&lt;-</span> <span class="st">"Pain severity"</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>pain_interf_sum) <span class="ot">&lt;-</span>  <span class="st">"Pain interference"</span></span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>dependence_level) <span class="ot">&lt;-</span> <span class="st">"Nicotine dependence"</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>Anxiety) <span class="ot">&lt;-</span> <span class="st">"Anxiety"</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>Depression) <span class="ot">&lt;-</span> <span class="st">"Depression"</span></span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>ca_sum) <span class="ot">&lt;-</span> <span class="st">"Pain Catastrophizing"</span></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>pps_sum) <span class="ot">&lt;-</span> <span class="st">"Mental defeat"</span></span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>suicidality_risk) <span class="ot">&lt;-</span> <span class="st">"Suicidality"</span></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>SIDSSI) <span class="ot">&lt;-</span> <span class="st">"Social interaction"</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>SSDSSI) <span class="ot">&lt;-</span> <span class="st">"Satisfaction with social support"</span></span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a><span class="fu">label</span>(final_data_clean<span class="sc">$</span>ISDSSI) <span class="ot">&lt;-</span> <span class="st">"Social support"</span></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print demographic characteristics</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Clinical and Psychosocial Characteristics Stratified by OUD Status"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Clinical and Psychosocial Characteristics Stratified by OUD Status</code></pre>
</div>
</div>
</section>
</section>
<section id="developing-ml-models" class="level2">
<h2 class="anchored" data-anchor-id="developing-ml-models">2.5 Developing ML models</h2>
<p>Given the skewness of the dataset, three algorithms were selected for their effectiveness in handling skewed variable distributions: Logistic Regression, Random Forest, and XGBoost.</p>
<section id="missing-data-imputation" class="level3">
<h3 class="anchored" data-anchor-id="missing-data-imputation">2.5.1 Missing data Imputation</h3>
<p>Before developing models, I need to address missing data. For this, random forest imputation was utilized. This method accounts for the distribution of variables and imputes values accordingly, rather than relying on mean, median, or mode. For continuous predictors, the imputed value is calculated as the weighted average of non-missing observations, with weights determined by proximities. For categorical predictors, the imputed value corresponds to the category with the highest average proximity. While most variables had less than 10% missing data, the mental defeat score (pps_sum) and suicidality risk exhibited significant levels of missingness. However, these variables are clinically important factors associated with the outcome (OUD). As such, they were included in the prediction model.</p>
<p>To evaluate whether these factors can be reliably incorporated and whether the imputation was performed appropriately, I will compare models with and without these variables. This analysis will be discussed in the section titled “Model Selection Despite Missing Data Imputation.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>randomForest 4.7-1.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type rfNews() to see new features/changes/bug fixes.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'randomForest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    margin</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="do">##Missing data count when merged</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(final_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           SubjID            cohort            DEM002            DEM003 
                0                 0                 0                 0 
           DEM004            DEM005            DEM006            DEM007 
                0                 0                 0                 0 
           DEM008 pain_severity_sum   pain_interf_sum  dependence_level 
                0                55               113                58 
          Anxiety        Depression            ca_sum           pps_sum 
               70                70               127               522 
 suicidality_risk            SIDSSI            SSDSSI            ISDSSI 
              606               100               114               103 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Missing data imputation, using randomforest package</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(final_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   1331 obs. of  20 variables:
 $ SubjID           : num  1000 1001 1002 1003 1004 ...
 $ cohort           : Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ DEM002           : Factor w/ 3 levels "(X)Subject refused to answer",..: 3 3 2 3 3 3 2 2 3 2 ...
  ..- attr(*, "label")= chr "What is your gender"
 $ DEM003           : num  35 32 28 42 27 39 24 42 39 39 ...
 $ DEM004           : Factor w/ 6 levels "(X)Subject refused to answer",..: 2 2 4 2 2 2 5 2 4 2 ...
  ..- attr(*, "label")= chr "Current marital status"
 $ DEM005           : Factor w/ 3 levels "Live alone","One other person",..: 1 2 1 2 2 2 1 2 1 3 ...
 $ DEM006           : Factor w/ 8 levels "Grade 6 or less",..: 1 4 3 5 6 7 6 2 5 3 ...
 $ DEM007           : Factor w/ 2 levels "Yes","No": 1 2 2 2 1 2 2 2 1 2 ...
 $ DEM008           : Factor w/ 3 levels "Ca not make ends meet",..: 1 2 1 2 3 2 2 3 3 1 ...
 $ pain_severity_sum: num  NA 32 25 12 13 20 22 23 22 25 ...
 $ pain_interf_sum  : num  NA 48 50 3 15 39 54 14 55 35 ...
 $ dependence_level : chr  "Moderate" "Non-smoker" "Non-smoker" "Non-smoker" ...
 $ Anxiety          : Factor w/ 2 levels "0","1": 2 2 2 2 2 2 1 1 2 1 ...
 $ Depression       : Factor w/ 2 levels "0","1": 2 2 2 1 2 2 2 1 2 1 ...
 $ ca_sum           : num  22 9 18 5 12 16 18 0 30 21 ...
 $ pps_sum          : num  NA NA NA 10 44 NA 26 NA NA NA ...
 $ suicidality_risk : chr  NA NA NA NA ...
 $ SIDSSI           : num  NA 5 4 10 3 4 5 9 5 9 ...
  ..- attr(*, "label")= chr "Total score for Social Interaction"
  ..- attr(*, "format.spss")= chr "F8.2"
 $ SSDSSI           : num  NA 13 9 21 21 17 15 21 10 21 ...
  ..- attr(*, "label")= chr "Total score for Subjective Support"
  ..- attr(*, "format.spss")= chr "F8.2"
 $ ISDSSI           : num  NA 8 10 6 12 9 10 9 0 11 ...
  ..- attr(*, "label")= chr "Total score for Instrumental Support"
  ..- attr(*, "format.spss")= chr "F8.2"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using rfImpute to impute missing values in predictor variables</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>final_data <span class="ot">&lt;-</span> final_data <span class="sc">%&gt;%</span></span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), as.factor))</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>imputed_data <span class="ot">&lt;-</span> <span class="fu">rfImpute</span>(cohort <span class="sc">~</span> ., <span class="at">data =</span> final_data, <span class="at">iter =</span> <span class="dv">5</span>, <span class="at">ntree =</span> <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ntree      OOB      1      2
  500:  13.30%  6.66% 27.21%
ntree      OOB      1      2
  500:  13.67%  6.22% 29.30%
ntree      OOB      1      2
  500:  13.60%  6.10% 29.30%
ntree      OOB      1      2
  500:  13.90%  6.99% 28.37%
ntree      OOB      1      2
  500:  13.37%  5.77% 29.30%</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>imputed_data <span class="ot">&lt;-</span> imputed_data <span class="sc">%&gt;%</span> </span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>SubjID)</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(imputed_data) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  cohort DEM002 DEM003            DEM004           DEM005
1      0 Female     35 Married/Partnered       Live alone
2      0 Female     32 Married/Partnered One other person
3      0   Male     28          Divorced       Live alone
4      0 Female     42 Married/Partnered One other person
5      0 Female     27 Married/Partnered One other person
6      0 Female     39 Married/Partnered One other person
                                           DEM006 DEM007
1                                 Grade 6 or less    Yes
2                                    Part college     No
3 Graduated high school or high school equivalent     No
4                       Graduated 2 years college     No
5                       Graduated 4 years college    Yes
6               Part graduate/professional school     No
                         DEM008 pain_severity_sum pain_interf_sum
1         Ca not make ends meet          22.13244        35.14718
2 Have just enough to get along          32.00000        48.00000
3         Ca not make ends meet          25.00000        50.00000
4 Have just enough to get along          12.00000         3.00000
5               Are comfortable          13.00000        15.00000
6 Have just enough to get along          20.00000        39.00000
  dependence_level Anxiety Depression ca_sum  pps_sum suicidality_risk
1         Moderate       1          1     22 31.55007         Low Risk
2       Non-smoker       1          1      9 28.27989         Low Risk
3       Non-smoker       1          1     18 36.99006         Low Risk
4       Non-smoker       1          0      5 10.00000         Low Risk
5       Non-smoker       1          1     12 44.00000         Low Risk
6       Non-smoker       1          1     16 27.12809         Low Risk
     SIDSSI   SSDSSI    ISDSSI
1  5.172568 18.16593  8.859307
2  5.000000 13.00000  8.000000
3  4.000000  9.00000 10.000000
4 10.000000 21.00000  6.000000
5  3.000000 21.00000 12.000000
6  4.000000 17.00000  9.000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">is.na</span>(imputed_data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           cohort            DEM002            DEM003            DEM004 
                0                 0                 0                 0 
           DEM005            DEM006            DEM007            DEM008 
                0                 0                 0                 0 
pain_severity_sum   pain_interf_sum  dependence_level           Anxiety 
                0                 0                 0                 0 
       Depression            ca_sum           pps_sum  suicidality_risk 
                0                 0                 0                 0 
           SIDSSI            SSDSSI            ISDSSI 
                0                 0                 0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(imputed_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> cohort                           DEM002        DEM003     
 0:901   (X)Subject refused to answer:  0   Min.   : 2.00  
 1:430   Male                        :530   1st Qu.:23.00  
         Female                      :801   Median :35.00  
                                            Mean   :33.92  
                                            3rd Qu.:44.00  
                                            Max.   :69.00  
                                                           
                          DEM004                           DEM005   
 (X)Subject refused to answer:  0   Live alone                :229  
 Married/Partnered           :637   One other person          :523  
 Separated                   : 61   More than one other person:579  
 Divorced                    :231                                   
 Never married               :355                                   
 Widowed                     : 47                                   
                                                                    
                                             DEM006    DEM007   
 Graduated high school or high school equivalent:350   Yes:350  
 Part college                                   :336   No :981  
 Graduated 4 years college                      :173            
 Graduated 2 years college                      :149            
 Completed graduate/professional school         :141            
 Grade 7 to 12                                  :126            
 (Other)                                        : 56            
                           DEM008    pain_severity_sum pain_interf_sum
 Ca not make ends meet        :392   Min.   : 0.00     Min.   : 0.00  
 Have just enough to get along:595   1st Qu.:16.15     1st Qu.:23.00  
 Are comfortable              :344   Median :21.00     Median :34.00  
                                     Mean   :20.86     Mean   :32.75  
                                     3rd Qu.:26.00     3rd Qu.:44.00  
                                     Max.   :40.00     Max.   :60.00  
                                                                      
        dependence_level Anxiety Depression     ca_sum         pps_sum     
 High           : 69     0:653   0:708      Min.   : 0.00   Min.   : 0.00  
 Low            :105     1:678   1:623      1st Qu.:10.00   1st Qu.:18.00  
 Low to Moderate:123                        Median :15.00   Median :29.89  
 Moderate       :196                        Mean   :15.42   Mean   :35.35  
 Non-smoker     :838                        3rd Qu.:21.00   3rd Qu.:53.40  
                                            Max.   :36.00   Max.   :96.00  
                                                                           
  suicidality_risk     SIDSSI           SSDSSI          ISDSSI      
 High Risk: 328    Min.   : 0.000   Min.   : 7.00   Min.   : 0.000  
 Low Risk :1003    1st Qu.: 4.000   1st Qu.:15.00   1st Qu.: 7.000  
                   Median : 5.000   Median :18.00   Median : 9.000  
                   Mean   : 5.159   Mean   :17.27   Mean   : 8.485  
                   3rd Qu.: 7.000   3rd Qu.:20.00   3rd Qu.:11.000  
                   Max.   :13.000   Max.   :21.00   Max.   :12.000  
                                                                    </code></pre>
</div>
</div>
</section>
<section id="missing-data-imputation-1" class="level3">
<h3 class="anchored" data-anchor-id="missing-data-imputation-1">2.5.2 Missing data Imputation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rsample)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span> (<span class="dv">1234</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>mydata_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(imputed_data,</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">strata =</span> cohort,<span class="co"># maintaining same percentage of cases/controls</span></span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>mydata_training <span class="ot">&lt;-</span> <span class="fu">training</span>(mydata_split)</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>mydata_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(mydata_split)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb133-10"><a href="#cb133-10" aria-hidden="true" tabindex="-1"></a><span class="co">#10-fold cross validation: given there is a small sample size and I am not doing parameter tuning, I will not create held out data and use the whole dataset.</span></span>
<span id="cb133-11"><a href="#cb133-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb133-12"><a href="#cb133-12" aria-hidden="true" tabindex="-1"></a>mydata_folds <span class="ot">&lt;-</span><span class="fu">vfold_cv</span>(imputed_data, <span class="at">v=</span><span class="dv">10</span>) <span class="co">#okay to use the whole data, without held out data</span></span>
<span id="cb133-13"><a href="#cb133-13" aria-hidden="true" tabindex="-1"></a>mydata_folds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#  10-fold cross-validation 
# A tibble: 10 × 2
   splits             id    
   &lt;list&gt;             &lt;chr&gt; 
 1 &lt;split [1197/134]&gt; Fold01
 2 &lt;split [1198/133]&gt; Fold02
 3 &lt;split [1198/133]&gt; Fold03
 4 &lt;split [1198/133]&gt; Fold04
 5 &lt;split [1198/133]&gt; Fold05
 6 &lt;split [1198/133]&gt; Fold06
 7 &lt;split [1198/133]&gt; Fold07
 8 &lt;split [1198/133]&gt; Fold08
 9 &lt;split [1198/133]&gt; Fold09
10 &lt;split [1198/133]&gt; Fold10</code></pre>
</div>
</div>
</section>
<section id="model-selection-with-missing-data-imputation" class="level3">
<h3 class="anchored" data-anchor-id="model-selection-with-missing-data-imputation">2.5.3. Model Selection With Missing Data Imputation</h3>
<p>In order to determine whether the imputation was done properly without changing the model performance too much, I will compare two models; one with all variables included and the other with excluding these two variabels. I could also compare the model using complete cases, but given that sample size between the models too different, I chose this comparison. When comparing, along with auc roc value, false negative (which has more clinically importance) will also be considered. I will select the model that has better performance with false negative. significant predictors in two models will also be compared.</p>
<section id="model-excluding-the-two-variables-with-significant-missingness" class="level4">
<h4 class="anchored" data-anchor-id="model-excluding-the-two-variables-with-significant-missingness">Model excluding the two variables with significant missingness</h4>
<p>This model can be compared with the model including these two variables in 2.5.4.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>imputed_data_drop <span class="ot">&lt;-</span> imputed_data <span class="sc">%&gt;%</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>pps_sum, <span class="sc">-</span>suicidality_risk)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span> (<span class="dv">1234</span>)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a>mydata_split_drop <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(imputed_data_drop,</span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">strata =</span> cohort,<span class="co">#maintaining same percentage of cases/controls</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">prop =</span> <span class="fl">0.80</span>)</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>mydata_training_drop <span class="ot">&lt;-</span> <span class="fu">training</span>(mydata_split_drop)</span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>mydata_test_drop <span class="ot">&lt;-</span> <span class="fu">testing</span>(mydata_split_drop)</span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>mydata_glm_drop <span class="ot">&lt;-</span> <span class="fu">glm</span> (cohort <span class="sc">~</span>., <span class="at">data =</span> mydata_training_drop, <span class="at">family =</span> <span class="fu">binomial</span>(logit))</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mydata_glm_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = cohort ~ ., family = binomial(logit), data = mydata_training_drop)

Coefficients:
                                                       Estimate Std. Error
(Intercept)                                            4.627784   1.455553
DEM002Female                                          -0.820466   0.197872
DEM003                                                -0.061854   0.009180
DEM004Separated                                        0.859015   0.430760
DEM004Divorced                                         0.831928   0.269969
DEM004Never married                                    0.972528   0.256705
DEM004Widowed                                          0.430978   0.674118
DEM005One other person                                 0.136359   0.300167
DEM005More than one other person                       0.442203   0.298660
DEM006Grade 7 to 12                                   -0.066535   1.150164
DEM006Graduated high school or high school equivalent -0.521607   1.121347
DEM006Part college                                    -1.017797   1.124317
DEM006Graduated 2 years college                       -1.473135   1.146749
DEM006Graduated 4 years college                       -1.103231   1.145894
DEM006Part graduate/professional school               -2.372943   1.332968
DEM006Completed graduate/professional school          -0.848058   1.163169
DEM007No                                              -0.127620   0.228938
DEM008Have just enough to get along                   -0.455798   0.214313
DEM008Are comfortable                                 -0.940314   0.324669
pain_severity_sum                                     -0.063138   0.016944
pain_interf_sum                                       -0.006745   0.009722
dependence_levelLow                                   -0.339054   0.467789
dependence_levelLow to Moderate                        0.445897   0.463541
dependence_levelModerate                               0.382217   0.431422
dependence_levelNon-smoker                            -1.457966   0.401971
Anxiety1                                              -0.114961   0.241653
Depression1                                            0.145923   0.245807
ca_sum                                                 0.045327   0.015598
SIDSSI                                                 0.143917   0.046754
SSDSSI                                                -0.062769   0.035832
ISDSSI                                                -0.068818   0.037659
                                                      z value Pr(&gt;|z|)    
(Intercept)                                             3.179 0.001476 ** 
DEM002Female                                           -4.146 3.38e-05 ***
DEM003                                                 -6.738 1.61e-11 ***
DEM004Separated                                         1.994 0.046132 *  
DEM004Divorced                                          3.082 0.002059 ** 
DEM004Never married                                     3.789 0.000152 ***
DEM004Widowed                                           0.639 0.522615    
DEM005One other person                                  0.454 0.649630    
DEM005More than one other person                        1.481 0.138708    
DEM006Grade 7 to 12                                    -0.058 0.953869    
DEM006Graduated high school or high school equivalent  -0.465 0.641816    
DEM006Part college                                     -0.905 0.365329    
DEM006Graduated 2 years college                        -1.285 0.198926    
DEM006Graduated 4 years college                        -0.963 0.335664    
DEM006Part graduate/professional school                -1.780 0.075044 .  
DEM006Completed graduate/professional school           -0.729 0.465945    
DEM007No                                               -0.557 0.577226    
DEM008Have just enough to get along                    -2.127 0.033438 *  
DEM008Are comfortable                                  -2.896 0.003777 ** 
pain_severity_sum                                      -3.726 0.000194 ***
pain_interf_sum                                        -0.694 0.487818    
dependence_levelLow                                    -0.725 0.468575    
dependence_levelLow to Moderate                         0.962 0.336081    
dependence_levelModerate                                0.886 0.375646    
dependence_levelNon-smoker                             -3.627 0.000287 ***
Anxiety1                                               -0.476 0.634269    
Depression1                                             0.594 0.552748    
ca_sum                                                  2.906 0.003661 ** 
SIDSSI                                                  3.078 0.002083 ** 
SSDSSI                                                 -1.752 0.079811 .  
ISDSSI                                                 -1.827 0.067640 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1339.23  on 1063  degrees of freedom
Residual deviance:  740.78  on 1033  degrees of freedom
AIC: 802.78

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mydata_glm_drop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      GVIF Df GVIF^(1/(2*Df))
DEM002            1.106117  1        1.051721
DEM003            1.389418  1        1.178736
DEM004            1.636000  4        1.063464
DEM005            1.438808  2        1.095218
DEM006            1.585320  7        1.033461
DEM007            1.191745  1        1.091671
DEM008            1.363803  2        1.080657
pain_severity_sum 1.847377  1        1.359183
pain_interf_sum   2.298961  1        1.516233
dependence_level  1.299333  4        1.033273
Anxiety           1.632128  1        1.277548
Depression        1.731304  1        1.315790
ca_sum            1.673912  1        1.293798
SIDSSI            1.233365  1        1.110570
SSDSSI            1.805111  1        1.343544
ISDSSI            1.433350  1        1.197226</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Model building</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>lr_cls_spec_2 <span class="ot">&lt;-</span> </span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>)</span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Model fit </span></span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>lr_cls_fit_2 <span class="ot">&lt;-</span> </span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>  lr_cls_spec_2 <span class="sc">|&gt;</span></span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(cohort <span class="sc">~</span> ., <span class="at">data =</span> mydata_training_drop)</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Prediction using the "TEST" dataset</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>mydata.lr.pred.values.test_2 <span class="ot">&lt;-</span>  <span class="fu">bind_cols</span>(</span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">truth =</span> mydata_test_drop<span class="sc">$</span>cohort,</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lr_cls_fit_2, mydata_test_drop),</span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lr_cls_fit_2, mydata_test_drop, <span class="at">type =</span> <span class="st">"prob"</span>))</span>
<span id="cb139-16"><a href="#cb139-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-17"><a href="#cb139-17" aria-hidden="true" tabindex="-1"></a>mydata.lr.pred.values.test_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 267 × 4
   truth .pred_class .pred_0 .pred_1
   &lt;fct&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt;
 1 0     0             0.964  0.0360
 2 0     0             0.932  0.0682
 3 0     0             0.504  0.496 
 4 0     0             0.908  0.0916
 5 0     0             0.915  0.0847
 6 0     0             0.813  0.187 
 7 0     0             0.929  0.0706
 8 1     1             0.316  0.684 
 9 0     0             0.987  0.0126
10 0     0             0.788  0.212 
# ℹ 257 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ROC plots for testing data</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">roc_curve</span>(mydata.lr.pred.values.test_2, </span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>                   truth, </span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>                   .pred_0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Metrics of prediction on test data</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(mydata.lr.pred.values.test_2, truth, .pred_class, .pred_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  .metric     .estimator .estimate
  &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;
1 accuracy    binary         0.813
2 kap         binary         0.560
3 mn_log_loss binary         0.389
4 roc_auc     binary         0.886</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>conf_matrix_wihtout <span class="ot">&lt;-</span> mydata.lr.pred.values.test_2 <span class="sc">%&gt;%</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> truth, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the confusion matrix</span></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_matrix_wihtout)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   0   1
         0 160  29
         1  21  57</code></pre>
</div>
</div>
<p>Result: Given the similarity in model performance, the model that includes the two variables is preferable, as these variables hold clinical significance. More importantly, the imputation process does not appear to negatively affect the model’s performance. Especially, the model with the two variables showed a slightly higher AUC-ROC value (0.88596 &lt; 0.88655) and fewer false negative cases (exclusion model n=29 Vs inclusion model n=28 ). Clinically, minimizing false negatives is crucial in a predictive model. Therefore, further development of the algorithm will proceed using the imputed data with these two variables included.</p>
</section>
</section>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">2.5.4. Logistic regression</h3>
<section id="glm-trainingtest" class="level4">
<h4 class="anchored" data-anchor-id="glm-trainingtest">glm (Training/Test)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>mydata_glm <span class="ot">&lt;-</span> <span class="fu">glm</span> (cohort <span class="sc">~</span>., <span class="at">data =</span> mydata_training, <span class="at">family =</span> <span class="fu">binomial</span>(logit))</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mydata_glm) <span class="co">#sig: pain_severity, smoking low, smoking non-smoker</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = cohort ~ ., family = binomial(logit), data = mydata_training)

Coefficients:
                                                       Estimate Std. Error
(Intercept)                                            4.966909   1.514315
DEM002Female                                          -0.855435   0.200785
DEM003                                                -0.058619   0.009319
DEM004Separated                                        0.682439   0.444632
DEM004Divorced                                         0.744889   0.274227
DEM004Never married                                    0.898088   0.261058
DEM004Widowed                                          0.231731   0.712808
DEM005One other person                                 0.063667   0.304478
DEM005More than one other person                       0.357006   0.303366
DEM006Grade 7 to 12                                   -0.265863   1.202139
DEM006Graduated high school or high school equivalent -0.638299   1.171917
DEM006Part college                                    -1.200642   1.175972
DEM006Graduated 2 years college                       -1.522322   1.196516
DEM006Graduated 4 years college                       -1.318752   1.197064
DEM006Part graduate/professional school               -2.367309   1.376463
DEM006Completed graduate/professional school          -1.030221   1.210349
DEM007No                                              -0.158469   0.232315
DEM008Have just enough to get along                   -0.384304   0.218800
DEM008Are comfortable                                 -0.839910   0.332169
pain_severity_sum                                     -0.057897   0.017155
pain_interf_sum                                       -0.007810   0.010007
dependence_levelLow                                   -0.487874   0.476103
dependence_levelLow to Moderate                        0.412754   0.470925
dependence_levelModerate                               0.315392   0.438255
dependence_levelNon-smoker                            -1.387557   0.406708
Anxiety1                                              -0.181279   0.247676
Depression1                                            0.092984   0.255479
ca_sum                                                 0.026281   0.016933
pps_sum                                                0.007399   0.005829
suicidality_riskLow Risk                              -0.725604   0.249713
SIDSSI                                                 0.152617   0.047449
SSDSSI                                                -0.045157   0.036524
ISDSSI                                                -0.067755   0.037895
                                                      z value Pr(&gt;|z|)    
(Intercept)                                             3.280 0.001038 ** 
DEM002Female                                           -4.260 2.04e-05 ***
DEM003                                                 -6.291 3.16e-10 ***
DEM004Separated                                         1.535 0.124823    
DEM004Divorced                                          2.716 0.006601 ** 
DEM004Never married                                     3.440 0.000581 ***
DEM004Widowed                                           0.325 0.745109    
DEM005One other person                                  0.209 0.834370    
DEM005More than one other person                        1.177 0.239268    
DEM006Grade 7 to 12                                    -0.221 0.824969    
DEM006Graduated high school or high school equivalent  -0.545 0.585986    
DEM006Part college                                     -1.021 0.307265    
DEM006Graduated 2 years college                        -1.272 0.203268    
DEM006Graduated 4 years college                        -1.102 0.270611    
DEM006Part graduate/professional school                -1.720 0.085460 .  
DEM006Completed graduate/professional school           -0.851 0.394671    
DEM007No                                               -0.682 0.495158    
DEM008Have just enough to get along                    -1.756 0.079017 .  
DEM008Are comfortable                                  -2.529 0.011453 *  
pain_severity_sum                                      -3.375 0.000739 ***
pain_interf_sum                                        -0.780 0.435172    
dependence_levelLow                                    -1.025 0.305493    
dependence_levelLow to Moderate                         0.876 0.380772    
dependence_levelModerate                                0.720 0.471739    
dependence_levelNon-smoker                             -3.412 0.000646 ***
Anxiety1                                               -0.732 0.464218    
Depression1                                             0.364 0.715887    
ca_sum                                                  1.552 0.120654    
pps_sum                                                 1.269 0.204373    
suicidality_riskLow Risk                               -2.906 0.003664 ** 
SIDSSI                                                  3.216 0.001298 ** 
SSDSSI                                                 -1.236 0.216314    
ISDSSI                                                 -1.788 0.073776 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1339.23  on 1063  degrees of freedom
Residual deviance:  726.67  on 1031  degrees of freedom
AIC: 792.67

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(mydata_glm) <span class="co">#VIF all less than 5; no significant colinearity was found among variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      GVIF Df GVIF^(1/(2*Df))
DEM002            1.113347  1        1.055153
DEM003            1.414278  1        1.189234
DEM004            1.678438  4        1.066874
DEM005            1.445951  2        1.096575
DEM006            1.634491  7        1.035718
DEM007            1.194095  1        1.092746
DEM008            1.401302  2        1.088010
pain_severity_sum 1.849782  1        1.360067
pain_interf_sum   2.386438  1        1.544810
dependence_level  1.364955  4        1.039656
Anxiety           1.678649  1        1.295627
Depression        1.825421  1        1.351081
ca_sum            1.957453  1        1.399090
pps_sum           2.232918  1        1.494295
suicidality_risk  1.484447  1        1.218379
SIDSSI            1.253841  1        1.119750
SSDSSI            1.837882  1        1.355685
ISDSSI            1.436973  1        1.198738</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Model building</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>lr_cls_spec <span class="ot">&lt;-</span> </span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>)</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-6"><a href="#cb150-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Model fit to training dataset</span></span>
<span id="cb150-7"><a href="#cb150-7" aria-hidden="true" tabindex="-1"></a>lr_cls_fit <span class="ot">&lt;-</span> </span>
<span id="cb150-8"><a href="#cb150-8" aria-hidden="true" tabindex="-1"></a>  lr_cls_spec <span class="sc">|&gt;</span></span>
<span id="cb150-9"><a href="#cb150-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(cohort <span class="sc">~</span> ., <span class="at">data =</span> mydata_training)</span>
<span id="cb150-10"><a href="#cb150-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-11"><a href="#cb150-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Prediction using the "testing" dataset</span></span>
<span id="cb150-12"><a href="#cb150-12" aria-hidden="true" tabindex="-1"></a>mydata.lr.pred.values.test <span class="ot">&lt;-</span>  <span class="fu">bind_cols</span>(</span>
<span id="cb150-13"><a href="#cb150-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">truth =</span> mydata_test<span class="sc">$</span>cohort,</span>
<span id="cb150-14"><a href="#cb150-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lr_cls_fit, mydata_test),</span>
<span id="cb150-15"><a href="#cb150-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(lr_cls_fit, mydata_test, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb150-16"><a href="#cb150-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb150-17"><a href="#cb150-17" aria-hidden="true" tabindex="-1"></a>mydata.lr.pred.values.test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 267 × 4
   truth .pred_class .pred_0 .pred_1
   &lt;fct&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt;
 1 0     0             0.964  0.0356
 2 0     0             0.909  0.0910
 3 0     1             0.410  0.590 
 4 0     0             0.895  0.105 
 5 0     0             0.925  0.0748
 6 0     0             0.835  0.165 
 7 0     0             0.924  0.0757
 8 1     1             0.177  0.823 
 9 0     0             0.983  0.0166
10 0     0             0.824  0.176 
# ℹ 257 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ROC plots for "testing" dataset</span></span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">roc_curve</span>(mydata.lr.pred.values.test, </span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>                   truth, </span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>                   .pred_0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Metrics of prediction on "testing" dataset</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">metrics</span>(mydata.lr.pred.values.test, truth, .pred_class, .pred_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  .metric     .estimator .estimate
  &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;
1 accuracy    binary         0.805
2 kap         binary         0.543
3 mn_log_loss binary         0.394
4 roc_auc     binary         0.886</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>conf_matrix_all <span class="ot">&lt;-</span> mydata.lr.pred.values.test <span class="sc">%&gt;%</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> truth, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb155-3"><a href="#cb155-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_matrix_all)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   0   1
         0 159  30
         1  22  56</code></pre>
</div>
</div>
</section>
<section id="logistic-regression---cross-validation-10-fold" class="level4">
<h4 class="anchored" data-anchor-id="logistic-regression---cross-validation-10-fold">Logistic Regression - Cross Validation (10-fold)</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co">#model building</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>lr_cls_spec_cv <span class="ot">&lt;-</span> </span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">logistic_reg</span>() <span class="sc">|&gt;</span> </span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>)</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a><span class="co">#Model fit to FULL dataset</span></span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>lr_cls_fit_cv <span class="ot">&lt;-</span> </span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>  lr_cls_spec_cv <span class="sc">|&gt;</span></span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(cohort <span class="sc">~</span> ., <span class="at">data =</span> imputed_data) <span class="co">#here, I'm using full data.</span></span>
<span id="cb157-10"><a href="#cb157-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-11"><a href="#cb157-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Create a workflow() for fitting the glm</span></span>
<span id="cb157-12"><a href="#cb157-12" aria-hidden="true" tabindex="-1"></a>glm_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb157-13"><a href="#cb157-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lr_cls_spec_cv) <span class="sc">|&gt;</span> </span>
<span id="cb157-14"><a href="#cb157-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(cohort <span class="sc">~</span> .)</span>
<span id="cb157-15"><a href="#cb157-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb157-16"><a href="#cb157-16" aria-hidden="true" tabindex="-1"></a><span class="co">#Cross validation fitting</span></span>
<span id="cb157-17"><a href="#cb157-17" aria-hidden="true" tabindex="-1"></a>glm_fit_cv <span class="ot">&lt;-</span> </span>
<span id="cb157-18"><a href="#cb157-18" aria-hidden="true" tabindex="-1"></a>  glm_wf <span class="sc">|&gt;</span></span>
<span id="cb157-19"><a href="#cb157-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(mydata_folds, <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span>
<span id="cb157-20"><a href="#cb157-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-21"><a href="#cb157-21" aria-hidden="true" tabindex="-1"></a><span class="co">#Collect predictions out of folds into one tibble</span></span>
<span id="cb157-22"><a href="#cb157-22" aria-hidden="true" tabindex="-1"></a>mydata_glm_cv_preds <span class="ot">&lt;-</span> <span class="fu">collect_predictions</span>(glm_fit_cv)</span>
<span id="cb157-23"><a href="#cb157-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-24"><a href="#cb157-24" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot of ROC curve of CV results</span></span>
<span id="cb157-25"><a href="#cb157-25" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">roc_curve</span>(mydata_glm_cv_preds, </span>
<span id="cb157-26"><a href="#cb157-26" aria-hidden="true" tabindex="-1"></a>        cohort, </span>
<span id="cb157-27"><a href="#cb157-27" aria-hidden="true" tabindex="-1"></a>        .pred_0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co">#To see performance of each fold</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>mydata_glm_cv_preds <span class="sc">|&gt;</span></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_auc</span>(cohort, .pred_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id     .metric .estimator .estimate
   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
 1 Fold01 roc_auc binary         0.905
 2 Fold02 roc_auc binary         0.900
 3 Fold03 roc_auc binary         0.911
 4 Fold04 roc_auc binary         0.924
 5 Fold05 roc_auc binary         0.878
 6 Fold06 roc_auc binary         0.893
 7 Fold07 roc_auc binary         0.900
 8 Fold08 roc_auc binary         0.889
 9 Fold09 roc_auc binary         0.880
10 Fold10 roc_auc binary         0.858</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Showing  roc curves for all folds</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>mydata_glm_cv_preds <span class="sc">|&gt;</span></span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0) <span class="sc">|&gt;</span></span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-11-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Overall metrics</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(glm_fit_cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  .metric     .estimator  mean     n std_err .config             
  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 accuracy    binary     0.835    10 0.00889 Preprocessor1_Model1
2 brier_class binary     0.117    10 0.00449 Preprocessor1_Model1
3 roc_auc     binary     0.894    10 0.00593 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix-for-lr" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix-for-lr">Confusion matrix for lr</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert probabilities to binary predictions using a threshold</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a>mydata_glm_cv_preds <span class="ot">&lt;-</span> mydata_glm_cv_preds <span class="sc">|&gt;</span> </span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">predicted =</span> <span class="fu">ifelse</span>(.pred_1 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>),               <span class="co"># Binary predictions</span></span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">predicted =</span> <span class="fu">factor</span>(predicted, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),       <span class="co"># Convert to factor</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort =</span> <span class="fu">factor</span>(cohort, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))              <span class="co"># Ensure cohort is a factor</span></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb163-8"><a href="#cb163-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-9"><a href="#cb163-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the confusion matrix</span></span>
<span id="cb163-10"><a href="#cb163-10" aria-hidden="true" tabindex="-1"></a>conf_mat_lr <span class="ot">&lt;-</span> <span class="fu">conf_mat</span>(mydata_glm_cv_preds, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb163-11"><a href="#cb163-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_mat_lr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   0   1
         0 811 130
         1  90 300</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>accuracy_lr <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(mydata_glm_cv_preds, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Precision</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>precision_lr<span class="ot">&lt;-</span> <span class="fu">precision</span>(mydata_glm_cv_preds, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall (Sensitivity)</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>recall_lr <span class="ot">&lt;-</span> <span class="fu">recall</span>(mydata_glm_cv_preds, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a><span class="co"># F1-Score</span></span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>f1_lr <span class="ot">&lt;-</span> <span class="fu">f_meas</span>(mydata_glm_cv_preds, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted, <span class="at">beta =</span> <span class="dv">1</span>)</span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display metrics</span></span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a>metrics_lr <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Accuracy"</span>, <span class="st">"Precision"</span>, <span class="st">"Recall"</span>, <span class="st">"F1-Score"</span>),</span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(accuracy_lr<span class="sc">$</span>.estimate, precision_lr<span class="sc">$</span>.estimate, recall_lr<span class="sc">$</span>.estimate, f1_lr<span class="sc">$</span>.estimate)</span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_lr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  Metric    Value
  &lt;chr&gt;     &lt;dbl&gt;
1 Accuracy  0.835
2 Precision 0.862
3 Recall    0.900
4 F1-Score  0.881</code></pre>
</div>
</div>
</section>
</section>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest">2.5.5. Random forest</h3>
<section id="testingtraining" class="level4">
<h4 class="anchored" data-anchor-id="testingtraining">Testing/Training</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'vip'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:utils':

    vi</code></pre>
</div>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Model specification/building</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>rf_spec <span class="ot">&lt;-</span> </span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rand_forest</span>(<span class="at">trees =</span> <span class="dv">300</span>,<span class="at">min_n =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="co">#Min number of data points in node for further split</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"randomForest"</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Model fit</span></span>
<span id="cb170-8"><a href="#cb170-8" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="ot">&lt;-</span> rf_spec <span class="sc">|&gt;</span></span>
<span id="cb170-9"><a href="#cb170-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(cohort <span class="sc">~</span> ., <span class="at">data =</span> mydata_training)</span>
<span id="cb170-10"><a href="#cb170-10" aria-hidden="true" tabindex="-1"></a>rf_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object


Call:
 randomForest(x = maybe_data_frame(x), y = y, ntree = ~300, nodesize = min_rows(~5,      x), importance = ~TRUE) 
               Type of random forest: classification
                     Number of trees: 300
No. of variables tried at each split: 4

        OOB estimate of  error rate: 14.94%
Confusion matrix:
    0   1 class.error
0 669  51  0.07083333
1 108 236  0.31395349</code></pre>
</div>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Prediction using the "TEST" dataset</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>rf_predicted <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">truth =</span> mydata_test<span class="sc">$</span>cohort,</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(rf_fit, mydata_test),</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(rf_fit, mydata_test, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a>rf_predicted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 267 × 4
   truth .pred_class .pred_0 .pred_1
   &lt;fct&gt; &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt;
 1 0     0             0.847  0.153 
 2 0     0             0.963  0.0367
 3 0     0             0.533  0.467 
 4 0     0             0.943  0.0567
 5 0     0             0.92   0.08  
 6 0     0             0.873  0.127 
 7 0     0             0.947  0.0533
 8 1     1             0.193  0.807 
 9 0     0             0.987  0.0133
10 0     0             0.84   0.16  
# ℹ 257 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co">#ROC plots for testing data</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">roc_auc</span>(rf_predicted, truth, .pred_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.869</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">roc_curve</span>(rf_predicted, </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>                   truth, </span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>                   .pred_0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="random-forest-cross-validation" class="level4">
<h4 class="anchored" data-anchor-id="random-forest-cross-validation">Random Forest Cross Validation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co">#I will then use cross-validation to re-estimate the predictive ability more fairly; I will use the same folds as created for the glm model above, "mydata_folds"</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="co">#workflow setup</span></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>rf_workflow <span class="ot">&lt;-</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_spec) <span class="sc">|&gt;</span></span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(cohort <span class="sc">~</span> .)</span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span> (<span class="dv">1234</span>)</span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a><span class="co">#Use workflow to fit model with each fold of re-sampled data</span></span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a>rf_fit_cv <span class="ot">&lt;-</span></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a>  rf_workflow <span class="sc">|&gt;</span></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(mydata_folds, <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span>
<span id="cb177-15"><a href="#cb177-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-16"><a href="#cb177-16" aria-hidden="true" tabindex="-1"></a><span class="co">#one ROC plot for cross validation datasets</span></span>
<span id="cb177-17"><a href="#cb177-17" aria-hidden="true" tabindex="-1"></a>rf_fit_cv <span class="sc">|&gt;</span></span>
<span id="cb177-18"><a href="#cb177-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">|&gt;</span></span>
<span id="cb177-19"><a href="#cb177-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0)<span class="sc">|&gt;</span></span>
<span id="cb177-20"><a href="#cb177-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect predictions for each fold</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>cv_predictions <span class="ot">&lt;-</span> rf_fit_cv <span class="sc">|&gt;</span> <span class="fu">collect_predictions</span>()</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="co"># To see the performance of each fold using ROC AUC</span></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a>cv_predictions <span class="sc">|&gt;</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_auc</span>(cohort, .pred_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id     .metric .estimator .estimate
   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
 1 Fold01 roc_auc binary         0.887
 2 Fold02 roc_auc binary         0.904
 3 Fold03 roc_auc binary         0.908
 4 Fold04 roc_auc binary         0.934
 5 Fold05 roc_auc binary         0.883
 6 Fold06 roc_auc binary         0.900
 7 Fold07 roc_auc binary         0.900
 8 Fold08 roc_auc binary         0.890
 9 Fold09 roc_auc binary         0.868
10 Fold10 roc_auc binary         0.875</code></pre>
</div>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co">#calculating overall roc value</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a>overall_roc_data <span class="ot">&lt;-</span> cv_predictions <span class="sc">|&gt;</span></span>
<span id="cb180-3"><a href="#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0)</span>
<span id="cb180-4"><a href="#cb180-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb180-5"><a href="#cb180-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Overall metrics</span></span>
<span id="cb180-6"><a href="#cb180-6" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(rf_fit_cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  .metric     .estimator  mean     n std_err .config             
  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 accuracy    binary     0.850    10 0.0108  Preprocessor1_Model1
2 brier_class binary     0.116    10 0.00376 Preprocessor1_Model1
3 roc_auc     binary     0.895    10 0.00598 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
<section id="creating-10-fold-cv-roc-curves-for-visualization" class="level4">
<h4 class="anchored" data-anchor-id="creating-10-fold-cv-roc-curves-for-visualization">Creating 10-fold CV ROC curves for visualization</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate ROC data for each fold</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>fold_roc_data <span class="ot">&lt;-</span> cv_predictions <span class="sc">|&gt;</span></span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0)</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for each fold</span></span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>fold_auc <span class="ot">&lt;-</span> cv_predictions <span class="sc">|&gt;</span></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_auc</span>(cohort, .pred_0)</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a>fold_auc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   id     .metric .estimator .estimate
   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
 1 Fold01 roc_auc binary         0.887
 2 Fold02 roc_auc binary         0.904
 3 Fold03 roc_auc binary         0.908
 4 Fold04 roc_auc binary         0.934
 5 Fold05 roc_auc binary         0.883
 6 Fold06 roc_auc binary         0.900
 7 Fold07 roc_auc binary         0.900
 8 Fold08 roc_auc binary         0.890
 9 Fold09 roc_auc binary         0.868
10 Fold10 roc_auc binary         0.875</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the overall ROC curve</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>overall_roc_data <span class="ot">&lt;-</span> cv_predictions <span class="sc">|&gt;</span></span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curves for each fold with AUC in legend and overlay overall ROC curve</span></span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>cv_predictions <span class="sc">|&gt;</span></span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">|&gt;</span></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0) <span class="sc">|&gt;</span></span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span></span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> overall_roc_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, <span class="at">y =</span> sensitivity), </span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"ROC Curves for Each Fold with Overall ROC Curve"</span>,</span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"False Positive Rate"</span>,</span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"True Positive Rate"</span>,</span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Fold"</span></span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co">#To understand the variables that most contribute tot eh classification, I extract the importance scores using the vip package.</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="sc">|&gt;</span></span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span></span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">importance</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                          0           1 MeanDecreaseAccuracy MeanDecreaseGini
DEM002             4.026389  4.38405894            5.4777384         6.789544
DEM003            20.662964 20.53486594           28.0255824        62.885876
DEM004            10.093715  9.65548949           13.4320418        27.367065
DEM005             3.855851  2.77096330            4.8384119         6.749288
DEM006             3.820470 12.13390429           11.1248910        25.317525
DEM007             2.052980 -1.79188324            0.8742595         2.400864
DEM008             4.168654  7.27184575            8.9313214        12.308780
pain_severity_sum  7.946187  9.25653351           11.8920462        25.326356
pain_interf_sum    8.251028  3.68486419            8.9878230        22.262909
dependence_level  20.735874 25.99276526           30.5605921        68.458427
Anxiety            4.395893  1.84527116            4.7427012         3.011653
Depression         5.439764 -1.59793914            4.3797246         2.652068
ca_sum             9.307695  1.94660765            9.3931988        20.689784
pps_sum           13.754464  8.20291711           16.1328682        37.490833
suicidality_risk  10.800589  8.50933009           13.6450948        27.005520
SIDSSI             1.956558  0.47873236            1.8447027        13.900852
SSDSSI             9.678554  8.38198676           12.7908676        24.139783
ISDSSI             2.452895  0.06730346            2.1511759        14.176732</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>rf_fit <span class="sc">|&gt;</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_engine</span>() <span class="sc">|&gt;</span></span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="confusion-matrix-calculation" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix-calculation">Confusion matrix/ calculation</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that both 'cohort' (truth) and 'predicted' (estimate) are factors</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>cv_predictions <span class="ot">&lt;-</span> cv_predictions <span class="sc">|&gt;</span> </span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predicted =</span> <span class="fu">ifelse</span>(.pred_1 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>cv_predictions <span class="ot">&lt;-</span> cv_predictions <span class="sc">|&gt;</span></span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">predicted =</span> <span class="fu">factor</span>(predicted, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),  <span class="co"># Convert predicted to a factor</span></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort =</span> <span class="fu">factor</span>(cohort, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))         <span class="co"># Convert cohort to a factor</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix</span></span>
<span id="cb189-11"><a href="#cb189-11" aria-hidden="true" tabindex="-1"></a>conf_mat <span class="ot">&lt;-</span> cv_predictions <span class="sc">|&gt;</span> </span>
<span id="cb189-12"><a href="#cb189-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb189-13"><a href="#cb189-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_mat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction   0   1
         0 834 131
         1  67 299</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(cv_predictions, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Precision</span></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a>precision <span class="ot">&lt;-</span> <span class="fu">precision</span>(cv_predictions, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall (Sensitivity)</span></span>
<span id="cb191-8"><a href="#cb191-8" aria-hidden="true" tabindex="-1"></a>recall <span class="ot">&lt;-</span> <span class="fu">recall</span>(cv_predictions, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb191-9"><a href="#cb191-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-10"><a href="#cb191-10" aria-hidden="true" tabindex="-1"></a><span class="co"># F1-Score</span></span>
<span id="cb191-11"><a href="#cb191-11" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">f_meas</span>(cv_predictions, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted, <span class="at">beta =</span> <span class="dv">1</span>)</span>
<span id="cb191-12"><a href="#cb191-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-13"><a href="#cb191-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display metrics</span></span>
<span id="cb191-14"><a href="#cb191-14" aria-hidden="true" tabindex="-1"></a>metrics <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb191-15"><a href="#cb191-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Accuracy"</span>, <span class="st">"Precision"</span>, <span class="st">"Recall"</span>, <span class="st">"F1-Score"</span>),</span>
<span id="cb191-16"><a href="#cb191-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(accuracy<span class="sc">$</span>.estimate, precision<span class="sc">$</span>.estimate, recall<span class="sc">$</span>.estimate, f1<span class="sc">$</span>.estimate)</span>
<span id="cb191-17"><a href="#cb191-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb191-18"><a href="#cb191-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  Metric    Value
  &lt;chr&gt;     &lt;dbl&gt;
1 Accuracy  0.851
2 Precision 0.864
3 Recall    0.926
4 F1-Score  0.894</code></pre>
</div>
</div>
</section>
</section>
<section id="gradient-boosting" class="level3">
<h3 class="anchored" data-anchor-id="gradient-boosting">2.5.6 Gradient boosting</h3>
<section id="testingtraining-1" class="level4">
<h4 class="anchored" data-anchor-id="testingtraining-1">Testing/Training</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co">#loading the packages</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'xgboost'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    slice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Model specification/building</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>bt_spec <span class="ot">&lt;-</span> </span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="dv">50</span>,        <span class="co">#Number of trees</span></span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">tree_depth =</span> <span class="dv">4</span>) <span class="sc">|&gt;</span> <span class="co">#Max depth of tree</span></span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>) <span class="sc">|&gt;</span></span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>bt_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Boosted Tree Model Specification (classification)

Main Arguments:
  trees = 50
  tree_depth = 4

Computational engine: xgboost </code></pre>
</div>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Recipe</span></span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a>bt_recipe <span class="ot">&lt;-</span></span>
<span id="cb198-3"><a href="#cb198-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">recipe</span>(cohort <span class="sc">~</span> ., <span class="at">data =</span> mydata_training) <span class="sc">|&gt;</span></span>
<span id="cb198-4"><a href="#cb198-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb198-5"><a href="#cb198-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>())</span>
<span id="cb198-6"><a href="#cb198-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-7"><a href="#cb198-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Workflow specification</span></span>
<span id="cb198-8"><a href="#cb198-8" aria-hidden="true" tabindex="-1"></a>bt_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb198-9"><a href="#cb198-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(bt_spec) <span class="sc">|&gt;</span></span>
<span id="cb198-10"><a href="#cb198-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(bt_recipe)</span>
<span id="cb198-11"><a href="#cb198-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-12"><a href="#cb198-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Model fit with training data</span></span>
<span id="cb198-13"><a href="#cb198-13" aria-hidden="true" tabindex="-1"></a>bt_fit <span class="ot">&lt;-</span> <span class="fu">fit</span>(bt_workflow, <span class="at">data =</span> mydata_training)</span>
<span id="cb198-14"><a href="#cb198-14" aria-hidden="true" tabindex="-1"></a>bt_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: boost_tree()

── Preprocessor ────────────────────────────────────────────────────────────────
2 Recipe Steps

• step_dummy()
• step_normalize()

── Model ───────────────────────────────────────────────────────────────────────
##### xgb.Booster
raw: 76 Kb 
call:
  xgboost::xgb.train(params = list(eta = 0.3, max_depth = 4, gamma = 0, 
    colsample_bytree = 1, colsample_bynode = 1, min_child_weight = 1, 
    subsample = 1), data = x$data, nrounds = 50, watchlist = x$watchlist, 
    verbose = 0, nthread = 1, objective = "binary:logistic")
params (as set within xgb.train):
  eta = "0.3", max_depth = "4", gamma = "0", colsample_bytree = "1", colsample_bynode = "1", min_child_weight = "1", subsample = "1", nthread = "1", objective = "binary:logistic", validate_parameters = "TRUE"
xgb.attributes:
  niter
callbacks:
  cb.evaluation.log()
# of features: 34 
niter: 50
nfeatures : 34 
evaluation_log:
  iter training_logloss
 &lt;num&gt;            &lt;num&gt;
     1        0.5494913
     2        0.4688789
   ---              ---
    49        0.1056357
    50        0.1036140</code></pre>
</div>
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Prediction model using the "TEST" dataset</span></span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>my.bt.pred <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb200-3"><a href="#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">truth =</span> mydata_test<span class="sc">$</span>cohort,</span>
<span id="cb200-4"><a href="#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(bt_fit, mydata_test),</span>
<span id="cb200-5"><a href="#cb200-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(bt_fit, mydata_test, <span class="at">type =</span> <span class="st">"prob"</span>))</span>
<span id="cb200-6"><a href="#cb200-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-7"><a href="#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="co">#ROC plots for testing data</span></span>
<span id="cb200-8"><a href="#cb200-8" aria-hidden="true" tabindex="-1"></a><span class="fu">roc_auc</span>(my.bt.pred, truth, </span>
<span id="cb200-9"><a href="#cb200-9" aria-hidden="true" tabindex="-1"></a>        .pred_0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.850</code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">roc_curve</span>(my.bt.pred, </span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>                   truth, </span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>                   .pred_0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Variable importance extracted with vip</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">vip</span>(bt_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance extracted from xgboost object</span></span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>bt_object <span class="ot">&lt;-</span> <span class="fu">pull_workflow_fit</span>(bt_fit)<span class="sc">$</span>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: `pull_workflow_fit()` was deprecated in workflows 0.2.3.
ℹ Please use `extract_fit_parsnip()` instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.importance</span>(<span class="at">model =</span> bt_object)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                   Feature         Gain
                                                    &lt;char&gt;        &lt;num&gt;
 1:                            dependence_level_Non.smoker 0.2534845837
 2:                                                 DEM003 0.1545459819
 3:                                      pain_severity_sum 0.0863324501
 4:                                                pps_sum 0.0796730463
 5:                                                 SSDSSI 0.0564596582
 6:                                        pain_interf_sum 0.0557903096
 7:                                                 SIDSSI 0.0390008605
 8:                                                 ISDSSI 0.0367593383
 9:                              suicidality_risk_Low.Risk 0.0361226035
10:                                                 ca_sum 0.0343426673
11:                               DEM004_Married.Partnered 0.0272755336
12:                                            DEM002_Male 0.0266537128
13:                                   DEM004_Never.married 0.0187864156
14:                                 DEM008_Are.comfortable 0.0155625330
15:                                   DEM006_Grade.7.to.12 0.0149001153
16: DEM006_Graduated.high.school.or.high.school.equivalent 0.0098376677
17:                      DEM005_More.than.one.other.person 0.0088055834
18:                   DEM008_Have.just.enough.to.get.along 0.0065204797
19:                       DEM006_Graduated.2.years.college 0.0058143701
20:               DEM006_Part.graduate.professional.school 0.0057781431
21:                              dependence_level_Moderate 0.0054099761
22:                       dependence_level_Low.to.Moderate 0.0050024402
23:                                              DEM007_No 0.0032944697
24:                                             Anxiety_X1 0.0032935801
25:                                DEM005_One.other.person 0.0026007154
26:                                          Depression_X1 0.0017991119
27:                                    DEM006_Part.college 0.0015287498
28:                       DEM006_Graduated.4.years.college 0.0014751143
29:                                   dependence_level_Low 0.0014135709
30:                                        DEM004_Divorced 0.0011115723
31:          DEM006_Completed.graduate.professional.school 0.0006246454
                                                   Feature         Gain
           Cover   Frequency
           &lt;num&gt;       &lt;num&gt;
 1: 0.0733554623 0.024305556
 2: 0.1462376766 0.102430556
 3: 0.1292185436 0.137152778
 4: 0.1330561620 0.135416667
 5: 0.0588442015 0.074652778
 6: 0.0679036638 0.098958333
 7: 0.0597097557 0.072916667
 8: 0.0462590366 0.062500000
 9: 0.0286800451 0.013888889
10: 0.0544051238 0.064236111
11: 0.0201647022 0.022569444
12: 0.0294635334 0.020833333
13: 0.0079794535 0.008680556
14: 0.0158569845 0.017361111
15: 0.0276753799 0.019097222
16: 0.0173869419 0.012152778
17: 0.0093800194 0.017361111
18: 0.0093178429 0.013888889
19: 0.0094988233 0.008680556
20: 0.0181956262 0.008680556
21: 0.0097776309 0.012152778
22: 0.0025596186 0.008680556
23: 0.0016861152 0.005208333
24: 0.0016136185 0.005208333
25: 0.0077745730 0.012152778
26: 0.0009572733 0.005208333
27: 0.0007357793 0.005208333
28: 0.0048880497 0.003472222
29: 0.0025441580 0.001736111
30: 0.0033991827 0.003472222
31: 0.0014750225 0.001736111
           Cover   Frequency</code></pre>
</div>
</div>
</section>
<section id="cross-validation---testingtraining" class="level4">
<h4 class="anchored" data-anchor-id="cross-validation---testingtraining">Cross Validation - Testing/Training</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co">#workflow setup</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a>bt_workflow <span class="ot">&lt;-</span></span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<span id="cb208-4"><a href="#cb208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(bt_spec) <span class="sc">|&gt;</span></span>
<span id="cb208-5"><a href="#cb208-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_formula</span>(cohort <span class="sc">~</span> .)</span>
<span id="cb208-6"><a href="#cb208-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-7"><a href="#cb208-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span> (<span class="dv">1234</span>)</span>
<span id="cb208-8"><a href="#cb208-8" aria-hidden="true" tabindex="-1"></a><span class="co">#Use workflow to fit model with each fold of re-sampled data</span></span>
<span id="cb208-9"><a href="#cb208-9" aria-hidden="true" tabindex="-1"></a>bt_fit_cv <span class="ot">&lt;-</span></span>
<span id="cb208-10"><a href="#cb208-10" aria-hidden="true" tabindex="-1"></a>  bt_workflow <span class="sc">|&gt;</span></span>
<span id="cb208-11"><a href="#cb208-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(mydata_folds, <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>))</span>
<span id="cb208-12"><a href="#cb208-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb208-13"><a href="#cb208-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ROC plots for cross validation datasets</span></span>
<span id="cb208-14"><a href="#cb208-14" aria-hidden="true" tabindex="-1"></a>bt_fit_cv <span class="sc">|&gt;</span></span>
<span id="cb208-15"><a href="#cb208-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">|&gt;</span></span>
<span id="cb208-16"><a href="#cb208-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0)<span class="sc">|&gt;</span></span>
<span id="cb208-17"><a href="#cb208-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Overall metrics</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(bt_fit_cv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 6
  .metric     .estimator  mean     n std_err .config             
  &lt;chr&gt;       &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 accuracy    binary     0.835    10 0.00857 Preprocessor1_Model1
2 brier_class binary     0.126    10 0.00520 Preprocessor1_Model1
3 roc_auc     binary     0.879    10 0.00816 Preprocessor1_Model1</code></pre>
</div>
</div>
</section>
<section id="confusion-matrix" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix">Confusion matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect predictions from the cross-validation results</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>bt_predictions <span class="ot">&lt;-</span> bt_fit_cv <span class="sc">|&gt;</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>()</span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert probabilities to binary predictions</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>bt_predictions <span class="ot">&lt;-</span> bt_predictions <span class="sc">|&gt;</span> </span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">predicted =</span> <span class="fu">ifelse</span>(.pred_1 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>),               <span class="co"># Binary predictions</span></span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">predicted =</span> <span class="fu">factor</span>(predicted, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),       <span class="co"># Convert to factor</span></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">cohort =</span> <span class="fu">factor</span>(cohort, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))              <span class="co"># Ensure cohort is a factor</span></span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb211-12"><a href="#cb211-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-13"><a href="#cb211-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate overall metrics</span></span>
<span id="cb211-14"><a href="#cb211-14" aria-hidden="true" tabindex="-1"></a>bt_metrics <span class="ot">&lt;-</span> bt_predictions <span class="sc">|&gt;</span></span>
<span id="cb211-15"><a href="#cb211-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted, .pred_1) <span class="sc">|&gt;</span></span>
<span id="cb211-16"><a href="#cb211-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(.metric <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"accuracy"</span>, <span class="st">"precision"</span>, <span class="st">"recall"</span>, <span class="st">"f_meas"</span>))</span>
<span id="cb211-17"><a href="#cb211-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-18"><a href="#cb211-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(bt_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.835</code></pre>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Accuracy</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>accuracy_bt <span class="ot">&lt;-</span> <span class="fu">accuracy</span>(bt_predictions, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Precision</span></span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>precision_bt<span class="ot">&lt;-</span> <span class="fu">precision</span>(bt_predictions, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall (Sensitivity)</span></span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>recall_bt<span class="ot">&lt;-</span> <span class="fu">recall</span>(bt_predictions, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted)</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a><span class="co"># F1-Score</span></span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a>f1_bt <span class="ot">&lt;-</span> <span class="fu">f_meas</span>(bt_predictions, <span class="at">truth =</span> cohort, <span class="at">estimate =</span> predicted, <span class="at">beta =</span> <span class="dv">1</span>)</span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display metrics</span></span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>metrics_bt <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Metric =</span> <span class="fu">c</span>(<span class="st">"Accuracy"</span>, <span class="st">"Precision"</span>, <span class="st">"Recall"</span>, <span class="st">"F1-Score"</span>),</span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">Value =</span> <span class="fu">c</span>(accuracy_bt<span class="sc">$</span>.estimate, precision_bt<span class="sc">$</span>.estimate, recall_bt<span class="sc">$</span>.estimate, f1_bt<span class="sc">$</span>.estimate)</span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_bt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 2
  Metric    Value
  &lt;chr&gt;     &lt;dbl&gt;
1 Accuracy  0.835
2 Precision 0.857
3 Recall    0.908
4 F1-Score  0.882</code></pre>
</div>
</div>
</section>
</section>
<section id="model-performance" class="level3">
<h3 class="anchored" data-anchor-id="model-performance">2.5.7.Model Performance</h3>
<p>Three predictive models were implemented to predict opioid use disorder. 10-fold cross validation was conducted to evaluate model performances. All predictive models achieved satisfactory performance (LR 0.885,) When comparing roc_auc values for those 3 algoriths with cross-validation, ramdom forests had the highest value; 0.89832.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Naming</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>lr_roc_data <span class="ot">&lt;-</span> <span class="fu">roc_curve</span>(mydata.lr.pred.values.test, truth, .pred_0)</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>lr_roc_cv_data <span class="ot">&lt;-</span> <span class="fu">roc_curve</span>(mydata_glm_cv_preds, cohort, .pred_0)</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>rf_roc_data <span class="ot">&lt;-</span> <span class="fu">roc_curve</span> (rf_predicted, truth,.pred_0)</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>rf_roc_cv_data <span class="ot">&lt;-</span> rf_fit_cv <span class="sc">|&gt;</span></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">|&gt;</span></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0)</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>bt_roc_data <span class="ot">&lt;-</span> <span class="fu">roc_curve</span> (my.bt.pred, truth, .pred_0)</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>bt_roc_data <span class="ot">&lt;-</span> bt_fit_cv <span class="sc">|&gt;</span></span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">collect_predictions</span>() <span class="sc">|&gt;</span></span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">roc_curve</span>(cohort, .pred_0)</span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a><span class="co">#ggplot</span></span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> lr_roc_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, </span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">y =</span> sensitivity, </span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">color =</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> lr_roc_cv_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, </span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">y =</span> sensitivity,</span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">color =</span> <span class="st">"lightblue"</span>)) <span class="sc">+</span></span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> rf_roc_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, </span>
<span id="cb215-22"><a href="#cb215-22" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">y =</span> sensitivity,</span>
<span id="cb215-23"><a href="#cb215-23" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">color =</span> <span class="st">"pink"</span>)) <span class="sc">+</span></span>
<span id="cb215-24"><a href="#cb215-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> rf_roc_cv_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, </span>
<span id="cb215-25"><a href="#cb215-25" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y =</span> sensitivity, </span>
<span id="cb215-26"><a href="#cb215-26" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">color =</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb215-27"><a href="#cb215-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">data =</span> bt_roc_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, </span>
<span id="cb215-28"><a href="#cb215-28" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y =</span> sensitivity, </span>
<span id="cb215-29"><a href="#cb215-29" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">color =</span> <span class="st">"purple"</span>)) <span class="sc">+</span></span>
<span id="cb215-30"><a href="#cb215-30" aria-hidden="true" tabindex="-1"></a>   <span class="fu">geom_path</span>(<span class="at">data =</span> bt_roc_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> specificity, </span>
<span id="cb215-31"><a href="#cb215-31" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">y =</span> sensitivity, </span>
<span id="cb215-32"><a href="#cb215-32" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">color =</span> <span class="st">"Green"</span>)) <span class="sc">+</span></span>
<span id="cb215-33"><a href="#cb215-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb215-34"><a href="#cb215-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Combined Cross-Validated ROC Curves with Confidence Intervals"</span>,</span>
<span id="cb215-35"><a href="#cb215-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"1 - Specificity (False Positive Rate)"</span>,</span>
<span id="cb215-36"><a href="#cb215-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Sensitivity (True Positive Rate)"</span>,</span>
<span id="cb215-37"><a href="#cb215-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Model"</span>,</span>
<span id="cb215-38"><a href="#cb215-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Model"</span></span>
<span id="cb215-39"><a href="#cb215-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb215-40"><a href="#cb215-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"lightblue"</span>, <span class="st">"pink"</span>, <span class="st">"red"</span>, <span class="st">"purple"</span>, <span class="st">"Green"</span>), </span>
<span id="cb215-41"><a href="#cb215-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"LR"</span>,</span>
<span id="cb215-42"><a href="#cb215-42" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"LR - 10-fold CV"</span>,</span>
<span id="cb215-43"><a href="#cb215-43" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"RF"</span>,</span>
<span id="cb215-44"><a href="#cb215-44" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"RF - 10-fold CV"</span>,</span>
<span id="cb215-45"><a href="#cb215-45" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"GT"</span>,</span>
<span id="cb215-46"><a href="#cb215-46" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"GT - 10-fold CV"</span>)) <span class="sc">+</span>  </span>
<span id="cb215-47"><a href="#cb215-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">lty =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb215-48"><a href="#cb215-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_equal</span>() <span class="sc">+</span></span>
<span id="cb215-49"><a href="#cb215-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="final_project_Lee_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="limitation" class="level2">
<h2 class="anchored" data-anchor-id="limitation">Limitation</h2>
<p>The results of these analysis need to be interpreted with caution. Importantly, due to the genotypic objective of the parent study, all participants were Caucasian participants, limiting the generalizability of findings to more diverse populations. Secondly, significant number of missing data were observed in two key factors within this model. Despite this, these variables are clinically considered highly relevant to the outcome, and their imputation does not appear to have adversely affected the model’s performance, as discussed previously. Lastly, this model was developed based on a relatively small sample size. However, it was specifically tailored for chronic pain patients on long-term opioid therapy, a population at higher risk of developing OUD compared to the general population. Considering that the model incorporates various significant risk factors that are often excluded from existing machine learning models, this model offers meaningful insights and potential contributions to the field.</p>
</section>
<section id="discussion" class="level1">
<h1>Discussion</h1>
<p>Random forest achieved the best predictive performance, with an area under the receiver operating characteristic curve of 0.89. Feature importance analysis identified nicotine dependence, age, and pain catastrophizing as the top three significant features. This model showed satisfactory prediction performance, and it can be a useful tool for clinicians to identify patients at risk for developing OUD and implement early intervention for prevention. Future studies are required to validate these findings externally.</p>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>